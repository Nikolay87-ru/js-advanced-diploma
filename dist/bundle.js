!function(){"use strict";var e={186:function(e,t,n){e.exports=n.p+"assets/2429af6d3a5796e3c34b.png"},227:function(e,t,n){e.exports=n.p+"assets/265b078c3f89d3c80dbb.png"},540:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},756:function(e,t,n){e.exports=n.p+"assets/37f8b2da9e57f436ca05.png"},942:function(e,t,n){e.exports=n.p+"assets/d868a744c00bd9f13c08.png"},1016:function(e,t,n){var a=n(1354),r=n.n(a),i=n(6314),o=n.n(i),s=n(4417),c=n.n(s),l=new URL(n(7935),n.b),h=new URL(n(1409),n.b),A=new URL(n(3232),n.b),d=new URL(n(1265),n.b),m=new URL(n(6267),n.b),p=new URL(n(186),n.b),u=new URL(n(9745),n.b),g=new URL(n(8490),n.b),C=new URL(n(2573),n.b),f=new URL(n(4496),n.b),E=new URL(n(8956),n.b),b=new URL(n(9221),n.b),y=new URL(n(6092),n.b),v=new URL(n(4184),n.b),B=new URL(n(5513),n.b),x=new URL(n(3062),n.b),w=new URL(n(4875),n.b),k=new URL(n(5134),n.b),P=new URL(n(7335),n.b),L=new URL(n(6153),n.b),D=new URL(n(9e3),n.b),T=new URL(n(9593),n.b),M=new URL(n(5523),n.b),S=new URL(n(7986),n.b),U=new URL(n(4041),n.b),z=new URL(n(7538),n.b),G=new URL(n(1605),n.b),R=new URL(n(6318),n.b),$=new URL(n(3933),n.b),N=new URL(n(6291),n.b),q=new URL(n(9702),n.b),j=new URL(n(1906),n.b),I=new URL(n(4347),n.b),Y=new URL(n(1216),n.b),X=new URL(n(4437),n.b),O=new URL(n(3160),n.b),H=new URL(n(8782),n.b),W=new URL(n(2076),n.b),Z=new URL(n(3860),n.b),F=new URL(n(6943),n.b),J=new URL(n(6168),n.b),Q=new URL(n(227),n.b),K=new URL(n(756),n.b),_=new URL(n(9334),n.b),V=new URL(n(942),n.b),ee=o()(r()),te=c()(l),ne=c()(h),ae=c()(A),re=c()(d),ie=c()(m),oe=c()(p),se=c()(u),ce=c()(g),le=c()(C),he=c()(f),Ae=c()(E),de=c()(b),me=c()(y),pe=c()(v),ue=c()(B),ge=c()(x),Ce=c()(w),fe=c()(k),Ee=c()(P),be=c()(L),ye=c()(D),ve=c()(T),Be=c()(M),xe=c()(S),we=c()(U),ke=c()(z),Pe=c()(G),Le=c()(R),De=c()($),Te=c()(N),Me=c()(q),Se=c()(j),Ue=c()(I),ze=c()(Y),Ge=c()(X),Re=c()(O),$e=c()(H),Ne=c()(W),qe=c()(Z),je=c()(F),Ie=c()(J),Ye=c()(Q),Xe=c()(K),Oe=c()(_),He=c()(V);ee.push([e.id,":root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n  cursor: pointer;\n\n  &:hover {\n    background-color:rgb(195, 197, 199);\n    transition: color 0.2s;\n  }\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.game-info {\n  background-color: #000;\n  color: white;\n  padding: 10px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n}\n\n.turn-indicator {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.game-message {\n  color: #4CAF50;\n  min-height: 20px;\n}\n\n.game-error {\n  color: #F44336;\n  min-height: 20px;\n}\n\n#game-board {\n  margin-top: 20px;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n  display: block; \n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n  display: block; \n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.cell:hover {\n  cursor: default;\n}\n\n.cell:hover .custom-tooltip {\n  display: block;\n}\n\n.custom-tooltip {\n  position: absolute;\n  z-index: 9999;\n  bottom: 100%;\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n  color: white;\n  border-radius: 4px;\n  min-width: 250px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n  font-size: 10px;\n  pointer-events: none;\n  display: flex; \n}\n\n\n.custom-tooltip .character-type {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url("+te+");\n  --map-tile-top-url: url("+ne+");\n  --map-tile-top-right-url: url("+ae+");\n  --map-tile-bottom-left-url: url("+re+");\n  --map-tile-bottom-url: url("+ie+");\n  --map-tile-bottom-right-url: url("+oe+");\n  --map-tile-left-url: url("+se+");\n  --map-tile-right-url: url("+ce+");\n  --map-tile-center-url: url("+le+");\n}\n\n.board.desert {\n  --map-tile-top-left-url: url("+he+");\n  --map-tile-top-url: url("+Ae+");\n  --map-tile-top-right-url: url("+de+");\n  --map-tile-bottom-left-url: url("+me+");\n  --map-tile-bottom-url: url("+pe+");\n  --map-tile-bottom-right-url: url("+ue+");\n  --map-tile-left-url: url("+ge+");\n  --map-tile-right-url: url("+Ce+");\n  --map-tile-center-url: url("+fe+");\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url("+Ee+");\n  --map-tile-top-url: url("+be+");\n  --map-tile-top-right-url: url("+ye+");\n  --map-tile-bottom-left-url: url("+ve+");\n  --map-tile-bottom-url: url("+Be+");\n  --map-tile-bottom-right-url: url("+xe+");\n  --map-tile-left-url: url("+we+");\n  --map-tile-right-url: url("+ke+");\n  --map-tile-center-url: url("+Pe+");\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url("+Le+");\n  --map-tile-top-url: url("+De+");\n  --map-tile-top-right-url: url("+Te+");\n  --map-tile-bottom-left-url: url("+Me+");\n  --map-tile-bottom-url: url("+Se+");\n  --map-tile-bottom-right-url: url("+Ue+");\n  --map-tile-left-url: url("+ze+");\n  --map-tile-right-url: url("+Ge+");\n  --map-tile-center-url: url("+Re+");\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 1001;\n}\n\n.character.moving {\n  background: url("+$e+");\n}\n\n.character.bowman {\n  background: url("+Ne+");\n}\n\n.character.daemon {\n  background: url("+qe+");\n}\n\n.character.magician {\n  background: url("+je+");\n}\n\n.character.swordsman {\n  background: url("+Ie+");\n}\n\n.character.undead {\n  background: url("+Ye+");\n}\n\n.character.vampire {\n  background: url("+Xe+");\n}\n\n.character.zombie {\n  background: url("+Oe+");\n}\n\n.character.dead {\n  background: url("+He+");\n  opacity: 0.7;\n  filter: grayscale(70%);\n  pointer-events: none;\n  cursor: not-allowed;\n}\n\n.character:hover {\n  cursor: pointer;\n}\n\n.character.dead:hover {\n  cursor: not-allowed;\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n// Меню выбора действий\n\n.action-menu {\n  z-index: 1002;\n  position: absolute;\n  background: rgba(0, 0, 0, 0.9);\n}\n\n.attack-menu {\n  left: 100%;\n  top: 50%;\n  transform: translateY(-50%);\n  position: absolute;\n  z-index: 1999;\n}\n\n.defence-menu {\n  left: 50%;\n  bottom: -50%;\n  transform: translateX(-50%);\n  position: absolute;\n  z-index: 1999;\n}\n\n.resurrect-menu {\n  left: 50%;\n  top: -50%;\n  transform: translateX(-50%);\n}\n\n.action-button {\n  background: #333;\n  color: white;\n  border: none;\n  padding: 8px 12px;\n  margin: 2px;\n  cursor: pointer;\n  border-radius: 3px;\n  text-align: left;\n  white-space: nowrap;\n}\n\n.action-button:hover {\n  background: #555;\n}\n\n// анимация перемещения\n\n.character.moving {\n  transition: transform 0.2s ease-in-out;\n  transform: scale(1.1);\n  filter: brightness(1.2);\n}\n\n#action-points {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  background: rgba(0, 0, 0, 0.7);\n  color: white;\n  padding: 10px;\n  border-radius: 5px;\n  font-family: 'Courier New', monospace;\n}\n\n#action-points h3 {\n  margin: 0 0 5px 0;\n  font-size: 1em;\n}\n\n#action-points p {\n  margin: 2px 0;\n  font-size: 0.9em;\n}\n\n/* Анимация урона */\n.damage {\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  color: #ff0;\n  font-weight: bold;\n  font-size: 1.2em;\n  z-index: 2000;\n  pointer-events: none;\n  text-shadow: 0 0 3px black;\n  will-change: transform, opacity;\n  animation: damageAnimation 1s forwards;\n}\n\n.damage.critical {\n  color: red;\n  animation: criticalHit 1s forwards;\n  z-index: 2000;\n}\n\n@keyframes damageAnimation {\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\n}\n\n@keyframes criticalHit {\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\n}\n\n/* Меню статиситки игры */\n\n#game-stats {\n  display: block;\n  color: white;\n  padding: 10px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n\n}\n\n","",{version:3,sources:["webpack://./src/css/style.css"],names:[],mappings:"AAAA;EACE,iBAAiB;AACnB;;AAEA;EACE,YAAY;EACZ,SAAS;AACX;;AAEA;EACE,gBAAgB;EAChB,eAAe;AACjB;;AAEA;EACE,qBAAqB;EACrB,gBAAgB;EAChB,cAAc;EACd,yBAAyB;EACzB,kBAAkB;EAClB,sBAAsB;EACtB,uBAAuB;EACvB,eAAe;EACf,gBAAgB;EAChB,qBAAqB;EACrB,8HAA8H;EAC9H,YAAY;EACZ,eAAe;;EAEf;IACE,mCAAmC;IACnC,sBAAsB;EACxB;AACF;;AAEA;EACE,kBAAkB;EAClB,cAAc;AAChB;;AAEA;EACE,sBAAsB;EACtB,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;AACvC;;AAEA;EACE,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,cAAc;EACd,gBAAgB;AAClB;;AAEA;EACE,cAAc;EACd,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,eAAe;AACjB;;AAEA;EACE,aAAa;EACb,qCAAqC;EACrC,oBAAoB;EACpB,iBAAiB;AACnB;;AAEA;EACE,kBAAkB;AACpB;;AAEA;EACE,WAAW;EACX,cAAc;EACd,WAAW;EACX,mBAAmB;EACnB,sBAAsB;EACtB,uBAAuB;EACvB,wBAAwB;EACxB,YAAY;EACZ,kBAAkB;AACpB;;AAEA;EACE,kBAAkB;EAClB,mBAAmB;EACnB,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,oBAAoB;EACpB,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,aAAa;EACb,YAAY;EACZ,SAAS;EACT,2BAA2B;EAC3B,oCAAoC;EACpC,YAAY;EACZ,kBAAkB;EAClB,gBAAgB;EAChB,kBAAkB;EAClB,qCAAqC;EACrC,eAAe;EACf,oBAAoB;EACpB,aAAa;AACf;;;AAGA;EACE,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,gEAAoE;EACpE,2DAA0D;EAC1D,iEAAsE;EACtE,mEAA0E;EAC1E,8DAAgE;EAChE,oEAA4E;EAC5E,4DAA4D;EAC5D,6DAA8D;EAC9D,8DAAgE;AAClE;;AAEA;EACE,gEAAmE;EACnE,4DAAyD;EACzD,kEAAqE;EACrE,oEAAyE;EACzE,+DAA+D;EAC/D,qEAA2E;EAC3E,6DAA2D;EAC3D,8DAA6D;EAC7D,+DAA+D;AACjE;;AAEA;EACE,iEAAmE;EACnE,4DAAyD;EACzD,kEAAqE;EACrE,oEAAyE;EACzE,+DAA+D;EAC/D,qEAA2E;EAC3E,6DAA2D;EAC3D,8DAA6D;EAC7D,+DAA+D;AACjE;;AAEA;EACE,iEAAqE;EACrE,4DAA2D;EAC3D,kEAAuE;EACvE,oEAA2E;EAC3E,+DAAiE;EACjE,qEAA6E;EAC7E,6DAA6D;EAC7D,8DAA+D;EAC/D,+DAAiE;AACnE;;AAEA;EACE,uBAAuB;EACvB,wBAAwB;AAC1B;;AAEA;EACE,wCAAwC;AAC1C;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,yCAAyC;AAC3C;;AAEA;EACE,2CAA2C;AAC7C;;AAEA;EACE,sCAAsC;AACxC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,oCAAoC;AACtC;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sCAAsC;AACxC;;AAEA;EACE,uBAAuB;EACvB,wBAAwB;EACxB,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAAiD;AACnD;;AAEA;EACE,oDAAkD;AACpD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAAgD;AAClD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA6C;EAC7C,YAAY;EACZ,sBAAsB;EACtB,oBAAoB;EACpB,mBAAmB;AACrB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,QAAQ;EACR,SAAS;EACT,kBAAkB;EAClB,WAAW;EACX,WAAW;EACX,gBAAgB;AAClB;;AAEA;EACE,WAAW;AACb;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;;;EAGE,aAAa;EACb,kBAAkB;EAClB,8BAA8B;AAChC;;AAEA;EACE,UAAU;EACV,QAAQ;EACR,2BAA2B;EAC3B,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,SAAS;EACT,YAAY;EACZ,2BAA2B;EAC3B,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,SAAS;EACT,SAAS;EACT,2BAA2B;AAC7B;;AAEA;EACE,gBAAgB;EAChB,YAAY;EACZ,YAAY;EACZ,iBAAiB;EACjB,WAAW;EACX,eAAe;EACf,kBAAkB;EAClB,gBAAgB;EAChB,mBAAmB;AACrB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;;;EAGE,sCAAsC;EACtC,qBAAqB;EACrB,uBAAuB;AACzB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,8BAA8B;EAC9B,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;AACvC;;AAEA;EACE,iBAAiB;EACjB,cAAc;AAChB;;AAEA;EACE,aAAa;EACb,gBAAgB;AAClB;;AAEA,mBAAmB;AACnB;EACE,kBAAkB;EAClB,MAAM;EACN,SAAS;EACT,2BAA2B;EAC3B,WAAW;EACX,iBAAiB;EACjB,gBAAgB;EAChB,aAAa;EACb,oBAAoB;EACpB,0BAA0B;EAC1B,+BAA+B;EAC/B,sCAAsC;AACxC;;AAEA;EACE,UAAU;EACV,kCAAkC;EAClC,aAAa;AACf;;AAEA;EACE,KAAK,kDAAkD,EAAE,UAAU,EAAE;EACrE,OAAO,yDAAyD,EAAE,UAAU,EAAE;AAChF;;AAEA;EACE,KAAK,oCAAoC,EAAE,UAAU,EAAE;EACvD,MAAM,oCAAoC,EAAE,UAAU,EAAE;EACxD,OAAO,sCAAsC,EAAE,UAAU,EAAE;AAC7D;;AAEA,yBAAyB;;AAEzB;EACE,cAAc;EACd,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;;AAEvC",sourcesContent:[":root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n  cursor: pointer;\n\n  &:hover {\n    background-color:rgb(195, 197, 199);\n    transition: color 0.2s;\n  }\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.game-info {\n  background-color: #000;\n  color: white;\n  padding: 10px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n}\n\n.turn-indicator {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.game-message {\n  color: #4CAF50;\n  min-height: 20px;\n}\n\n.game-error {\n  color: #F44336;\n  min-height: 20px;\n}\n\n#game-board {\n  margin-top: 20px;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n  display: block; \n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n  display: block; \n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.cell:hover {\n  cursor: default;\n}\n\n.cell:hover .custom-tooltip {\n  display: block;\n}\n\n.custom-tooltip {\n  position: absolute;\n  z-index: 9999;\n  bottom: 100%;\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n  color: white;\n  border-radius: 4px;\n  min-width: 250px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n  font-size: 10px;\n  pointer-events: none;\n  display: flex; \n}\n\n\n.custom-tooltip .character-type {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url('../img/prairie/map-tile-top-left.png');\n  --map-tile-top-url: url('../img/prairie/map-tile-top.png');\n  --map-tile-top-right-url: url('../img/prairie/map-tile-top-right.png');\n  --map-tile-bottom-left-url: url('../img/prairie/map-tile-bottom-left.png');\n  --map-tile-bottom-url: url('../img/prairie/map-tile-bottom.png');\n  --map-tile-bottom-right-url: url('../img/prairie/map-tile-bottom-right.png');\n  --map-tile-left-url: url('../img/prairie/map-tile-left.png');\n  --map-tile-right-url: url('../img/prairie/map-tile-right.png');\n  --map-tile-center-url: url('../img/prairie/map-tile-center.png');\n}\n\n.board.desert {\n  --map-tile-top-left-url: url('../img/desert/map-tile-top-left.png');\n  --map-tile-top-url: url('../img/desert/map-tile-top.png');\n  --map-tile-top-right-url: url('../img/desert/map-tile-top-right.png');\n  --map-tile-bottom-left-url: url('../img/desert/map-tile-bottom-left.png');\n  --map-tile-bottom-url: url('../img/desert/map-tile-bottom.png');\n  --map-tile-bottom-right-url: url('../img/desert/map-tile-bottom-right.png');\n  --map-tile-left-url: url('../img/desert/map-tile-left.png');\n  --map-tile-right-url: url('../img/desert/map-tile-right.png');\n  --map-tile-center-url: url('../img/desert/map-tile-center.png');\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url('../img/arctic/map-tile-top-left.png');\n  --map-tile-top-url: url('../img/arctic/map-tile-top.png');\n  --map-tile-top-right-url: url('../img/arctic/map-tile-top-right.png');\n  --map-tile-bottom-left-url: url('../img/arctic/map-tile-bottom-left.png');\n  --map-tile-bottom-url: url('../img/arctic/map-tile-bottom.png');\n  --map-tile-bottom-right-url: url('../img/arctic/map-tile-bottom-right.png');\n  --map-tile-left-url: url('../img/arctic/map-tile-left.png');\n  --map-tile-right-url: url('../img/arctic/map-tile-right.png');\n  --map-tile-center-url: url('../img/arctic/map-tile-center.png');\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url('../img/mountain/map-tile-top-left.png');\n  --map-tile-top-url: url('../img/mountain/map-tile-top.png');\n  --map-tile-top-right-url: url('../img/mountain/map-tile-top-right.png');\n  --map-tile-bottom-left-url: url('../img/mountain/map-tile-bottom-left.png');\n  --map-tile-bottom-url: url('../img/mountain/map-tile-bottom.png');\n  --map-tile-bottom-right-url: url('../img/mountain/map-tile-bottom-right.png');\n  --map-tile-left-url: url('../img/mountain/map-tile-left.png');\n  --map-tile-right-url: url('../img/mountain/map-tile-right.png');\n  --map-tile-center-url: url('../img/mountain/map-tile-center.png');\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 1001;\n}\n\n.character.moving {\n  background: url('../img/characters/moving.png');\n}\n\n.character.bowman {\n  background: url('../img/characters/bowman.png');\n}\n\n.character.daemon {\n  background: url('../img/characters/daemon.png');\n}\n\n.character.magician {\n  background: url('../img/characters/magician.png');\n}\n\n.character.swordsman {\n  background: url('../img/characters/swordsman.png');\n}\n\n.character.undead {\n  background: url('../img/characters/undead.png');\n}\n\n.character.vampire {\n  background: url('../img/characters/vampire.png');\n}\n\n.character.zombie {\n  background: url('../img/characters/zombie.png');\n}\n\n.character.dead {\n  background: url('../img/characters/dead.png');\n  opacity: 0.7;\n  filter: grayscale(70%);\n  pointer-events: none;\n  cursor: not-allowed;\n}\n\n.character:hover {\n  cursor: pointer;\n}\n\n.character.dead:hover {\n  cursor: not-allowed;\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n// Меню выбора действий\n\n.action-menu {\n  z-index: 1002;\n  position: absolute;\n  background: rgba(0, 0, 0, 0.9);\n}\n\n.attack-menu {\n  left: 100%;\n  top: 50%;\n  transform: translateY(-50%);\n  position: absolute;\n  z-index: 1999;\n}\n\n.defence-menu {\n  left: 50%;\n  bottom: -50%;\n  transform: translateX(-50%);\n  position: absolute;\n  z-index: 1999;\n}\n\n.resurrect-menu {\n  left: 50%;\n  top: -50%;\n  transform: translateX(-50%);\n}\n\n.action-button {\n  background: #333;\n  color: white;\n  border: none;\n  padding: 8px 12px;\n  margin: 2px;\n  cursor: pointer;\n  border-radius: 3px;\n  text-align: left;\n  white-space: nowrap;\n}\n\n.action-button:hover {\n  background: #555;\n}\n\n// анимация перемещения\n\n.character.moving {\n  transition: transform 0.2s ease-in-out;\n  transform: scale(1.1);\n  filter: brightness(1.2);\n}\n\n#action-points {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  background: rgba(0, 0, 0, 0.7);\n  color: white;\n  padding: 10px;\n  border-radius: 5px;\n  font-family: 'Courier New', monospace;\n}\n\n#action-points h3 {\n  margin: 0 0 5px 0;\n  font-size: 1em;\n}\n\n#action-points p {\n  margin: 2px 0;\n  font-size: 0.9em;\n}\n\n/* Анимация урона */\n.damage {\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  color: #ff0;\n  font-weight: bold;\n  font-size: 1.2em;\n  z-index: 2000;\n  pointer-events: none;\n  text-shadow: 0 0 3px black;\n  will-change: transform, opacity;\n  animation: damageAnimation 1s forwards;\n}\n\n.damage.critical {\n  color: red;\n  animation: criticalHit 1s forwards;\n  z-index: 2000;\n}\n\n@keyframes damageAnimation {\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\n}\n\n@keyframes criticalHit {\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\n}\n\n/* Меню статиситки игры */\n\n#game-stats {\n  display: block;\n  color: white;\n  padding: 10px;\n  text-align: center;\n  font-family: 'Courier New', monospace;\n\n}\n\n"],sourceRoot:""}]),t.A=ee},1113:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1216:function(e,t,n){e.exports=n.p+"assets/c75f062dddba6e98fdc6.png"},1265:function(e,t,n){e.exports=n.p+"assets/26b5f224d8750119922d.png"},1354:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),i="/*# ".concat(r," */");return[t].concat([i]).join("\n")}return[t].join("\n")}},1409:function(e,t,n){e.exports=n.p+"assets/946aeb948db6313f1d85.png"},1605:function(e,t,n){e.exports=n.p+"assets/246277b8ca590816b3e8.png"},1906:function(e,t,n){e.exports=n.p+"assets/f462d2ed6eedca1e4fd9.png"},2076:function(e,t,n){e.exports=n.p+"assets/58480938b9b9c149761d.png"},2573:function(e,t,n){e.exports=n.p+"assets/0089a610e6611f679b50.png"},3062:function(e,t,n){e.exports=n.p+"assets/eb1f6e4f87b977012684.png"},3160:function(e,t,n){e.exports=n.p+"assets/6f6f7c09bde970b2e41b.png"},3232:function(e,t,n){e.exports=n.p+"assets/0ac7f8258ec7166dc957.png"},3860:function(e,t,n){e.exports=n.p+"assets/884da1ccd25db8dd2ba4.png"},3933:function(e,t,n){e.exports=n.p+"assets/8b928c3eb136543e573a.png"},4041:function(e,t,n){e.exports=n.p+"assets/3d9503e0a850fda86f82.png"},4184:function(e,t,n){e.exports=n.p+"assets/f1703771380a9959d979.png"},4347:function(e,t,n){e.exports=n.p+"assets/6bacb8e25ed9ecf726bf.png"},4417:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4437:function(e,t,n){e.exports=n.p+"assets/26fdc25019c24e87f11a.png"},4496:function(e,t,n){e.exports=n.p+"assets/258d884122fabfc2f312.png"},4875:function(e,t,n){e.exports=n.p+"assets/2c19971f327b288278bb.png"},5056:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5072:function(e){var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var i={},o=[],s=0;s<e.length;s++){var c=e[s],l=a.base?c[0]+a.base:c[0],h=i[l]||0,A="".concat(l," ").concat(h);i[l]=h+1;var d=n(A),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(m);else{var p=r(m,a);a.byIndex=s,t.splice(s,0,{identifier:A,updater:p,references:1})}o.push(A)}return o}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=a(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var s=n(i[o]);t[s].references--}for(var c=a(e,r),l=0;l<i.length;l++){var h=n(i[l]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}i=c}}},5134:function(e,t,n){e.exports=n.p+"assets/51e2a5de56bd631452fe.png"},5513:function(e,t,n){e.exports=n.p+"assets/5cf9c17d6a1ea7106a6c.png"},5523:function(e,t,n){e.exports=n.p+"assets/63aae58e4690953a3857.png"},6092:function(e,t,n){e.exports=n.p+"assets/13edb269e39172ddd74f.png"},6153:function(e,t,n){e.exports=n.p+"assets/e0aa3daf6d08c62c96d9.png"},6168:function(e,t,n){e.exports=n.p+"assets/0d75fae43e9f1e48f836.png"},6267:function(e,t,n){e.exports=n.p+"assets/07d5e8127645225478b6.png"},6291:function(e,t,n){e.exports=n.p+"assets/a1d2321024649b9d8f5f.png"},6314:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var h=[].concat(e[l]);a&&o[h[0]]||(void 0!==i&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=i),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),t.push(h))}},t}},6318:function(e,t,n){e.exports=n.p+"assets/ef1b0ea8c4e545d9aadc.png"},6943:function(e,t,n){e.exports=n.p+"assets/d005033b17a1141e4a23.png"},7335:function(e,t,n){e.exports=n.p+"assets/eab6a2cc5e89a4dd8e3f.png"},7538:function(e,t,n){e.exports=n.p+"assets/22e7c5ede3f747cbe27a.png"},7659:function(e){var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},7825:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7935:function(e,t,n){e.exports=n.p+"assets/46d63299c3420c030b4e.png"},7986:function(e,t,n){e.exports=n.p+"assets/ac9d74f57639792774bc.png"},8490:function(e,t,n){e.exports=n.p+"assets/6a84ae91f5d985ddc9ee.png"},8782:function(e,t,n){e.exports=n.p+"assets/0a77fc47d727eab6fd39.png"},8956:function(e,t,n){e.exports=n.p+"assets/dc3f97e7bbcd5ea1ded9.png"},9e3:function(e,t,n){e.exports=n.p+"assets/d31d84c693f649766aee.png"},9221:function(e,t,n){e.exports=n.p+"assets/2f1e1970c2c20cf3a8d5.png"},9334:function(e,t,n){e.exports=n.p+"assets/296dfeac15e2377fc1dc.png"},9593:function(e,t,n){e.exports=n.p+"assets/b27323cf850ed820855c.png"},9702:function(e,t,n){e.exports=n.p+"assets/1d70f1dab2dd418c3612.png"},9745:function(e,t,n){e.exports=n.p+"assets/546abb060a0837550fd1.png"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,exports:{}};return e[a](i,i.exports,n),i.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,n.nc=void 0;var a=n(5072),r=n.n(a),i=n(7825),o=n.n(i),s=n(7659),c=n.n(s),l=n(5056),h=n.n(l),A=n(540),d=n.n(A),m=n(1113),p=n.n(m),u=n(1016),g={};function C(e,t){const n=t-1,a=t*t-1,r=a-(t-1);return 0===e?"top-left":e===n?"top-right":e===r?"bottom-left":e===a?"bottom-right":e<n?"top":e>r?"bottom":e%t===0?"left":e%t===t-1?"right":"center"}g.styleTagTransform=p(),g.setAttributes=h(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d(),r()(u.A,g),u.A&&u.A.locals&&u.A.locals;class f{constructor(e,t="moving"){if("number"!=typeof e||e<1)throw new Error("Level must be a positive number");this.level=e,this.health=50,this.maxHealth=100,this.type=t,this.moveDistance=1,this.attackDistance=1,this.actionPoints=4,this.currentActionPoints=4,this.team="player",this.isDead=!1;for(let t=1;t<e;t++)this.levelUp();this.actions={attack:()=>({damage:10,cost:1}),hardAttack:()=>({damage:15,cost:2}),defence:()=>({defence:2*this.defence,cost:this.currentActionPoints}),resurrect:()=>({health:this.maxHealth/2,cost:2})},this.moveCost={straight:1,diagonal:1}}levelUp(){this.level++;const e=this.health+80;this.health=Math.min(e,this.maxHealth);const t=(80+this.health/this.maxHealth*100)/100;"number"==typeof this.attack&&(this.attack=Math.max(this.attack,Math.round(this.attack*t))),"number"==typeof this.defence&&(this.defence=Math.max(this.defence,Math.round(this.defence*t))),this.resetActionPoints()}calculateDistance(e,t){const n=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);return Math.max(n,a)}canAttack(e){return this.calculateDistance(this.position,e)<=this.attackDistance}getMoveCost(e,t,n){const a=e%n;return Math.floor(e/n)!==Math.floor(t/n)&&a!==t%n?this.moveCost.diagonal:this.moveCost.straight}resetActionPoints(){this.currentActionPoints=this.actionPoints}takeDamage(e){return this.health-=e,this.health<=0&&this.die(),this.health}die(){this.isDead=!0,this.health=0,this.currentActionPoints=0}}class E{constructor(e,t){if(!(e instanceof f))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}class b{constructor(e=[]){this.characters=e}}function y(e,t,n){const a=function*(e,t){for(;;){const n=e[Math.floor(Math.random()*e.length)],a=Math.floor(Math.random()*t)+1;yield new n(a)}}(e,t),r=[];for(let e=0;e<n;e++)r.push(a.next().value);return new b(r)}class v{static from(e){return new v(e.currentTurn,e.maxScore,e.currentLevel,e.playerTeam,e.enemyTeam,e.positionedPlayerCharacters,e.positionedEnemyCharacters)}constructor(e="player",t=0,n=1,a=null,r=null,i=[],o=[]){this.currentTurn=e,this.maxScore=t,this.currentLevel=n,this.playerTeam=a,this.enemyTeam=r,this.positionedPlayerCharacters=i,this.positionedEnemyCharacters=o}serialize(){const e=t=>{if(Array.isArray(t))return t.map((t=>e(t)));if(t instanceof E)return{character:e(t.character),position:t.position};if(t instanceof f){const e={};return Object.keys(t).forEach((n=>{"function"!=typeof t[n]&&"actions"!==n&&"moveCost"!==n&&(e[n]=t[n])})),e.type=t.type,e}return t};return e({currentTurn:this.currentTurn,maxScore:this.maxScore,currentLevel:this.currentLevel,playerTeam:this.playerTeam,enemyTeam:this.enemyTeam,positionedPlayerCharacters:this.positionedPlayerCharacters,positionedEnemyCharacters:this.positionedEnemyCharacters,isGameLocked:!1})}}class B{constructor(e,t){this.storage=e,this.gamePlay=t}save(e){try{const t=new v(e.currentTurn,e.maxScore,e.currentLevel,e.playerTeam,e.enemyTeam,e.positionedPlayerCharacters,e.positionedEnemyCharacters).serialize();this.storage.setItem("state",JSON.stringify(t)),this.gamePlay.showMessage("Игра сохранена")}catch(e){console.error("Ошибка сохранения:",e),this.gamePlay.showError("Не удалось сохранить игру")}}load(){try{const e=JSON.parse(this.storage.getItem("state"));if(!e)throw new Error("Нет сохраненных данных");return console.log("Loaded data:",JSON.parse(JSON.stringify(e))),this.gamePlay.showMessage("Игра загружена"),v.from(e)}catch(e){throw console.error("Load error:",e),this.gamePlay.showError("Не удалось загрузить игру"),e}}}class x extends f{constructor(e){super(e),this.attack="15-25",this.defence=25,this.type="bowman",this.moveDistance=4,this.attackDistance=3,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+15,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})},this.moveCost={straight:1,diagonal:2}}}class w extends f{constructor(e){super(e),this.attack="30-40",this.defence=10,this.type="swordsman",this.moveDistance=4,this.attackDistance=1,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+30,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+40,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})}}}class k extends f{constructor(e){super(e),this.attack="10-20",this.defence=40,this.type="magician",this.moveDistance=2,this.attackDistance=4,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+10,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})},this.actions.resurrect=()=>({healthRestored:this.maxHealth/2,cost:2}),this.moveCost={straight:2,diagonal:3}}}class P extends f{constructor(e){super(e),this.attack="10-20",this.defence=40,this.type="daemon",this.moveDistance=2,this.attackDistance=2,this.team="enemy",this.actions={attack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}class L extends f{constructor(e){super(e),this.attack="30-40",this.defence=10,this.type="undead",this.moveDistance=4,this.attackDistance=2,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+30,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}class D extends f{constructor(e){super(e),this.attack="15-25",this.defence=25,this.type="vampire",this.moveDistance=2,this.attackDistance=2,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+10,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}const T=new class{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div id="game-stats">\n        <div>Уровень: <span id="current-level">1</span></div>\n        <div>Макс. счет: <span id="max-score">0</span></div>\n      </div>\n      <div id="action-points"></div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n      <div class="game-info">\n        <div id="current-turn" class="turn-indicator"></div>\n        <div id="game-message" class="game-message"></div>\n        <div id="game-error" class="game-error"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.saveGameEl.addEventListener("click",(e=>this.onSaveGameClick(e))),this.loadGameEl.addEventListener("click",(e=>this.onLoadGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const t=document.createElement("div");t.classList.add("cell","map-tile",`map-tile-${C(e,this.boardSize)}`),t.addEventListener("mouseenter",(e=>this.onCellEnter(e))),t.addEventListener("mouseleave",(e=>this.onCellLeave(e))),t.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(t)}this.cells=Array.from(this.boardEl.children)}updateStats(e,t){const n=document.getElementById("current-level"),a=document.getElementById("max-score");n&&(n.textContent=e),a&&(a.textContent=t)}redrawPositions(e){this.cells.forEach((e=>e.innerHTML="")),e.forEach((e=>{const t=this.boardEl.children[e.position],n=document.createElement("div");n.classList.add("character",e.character.isDead?"dead":e.character.type);const a=document.createElement("div");a.classList.add("health-level");const r=document.createElement("div");var i;r.classList.add("health-level-indicator","health-level-indicator-"+((i=e.character.health)<15?"critical":i<50?"normal":"high")),r.style.width=`${e.character.health}%`,a.appendChild(r),n.appendChild(a),t.appendChild(n)}))}addCellClickListener(e){this.cellClickListeners.push(e)}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}findCharacterByPosition(e,t){return e.find((e=>e.position===t))?.character}findPositionByCharacter(e,t){const n=e.find((e=>e.character===t));return n||(console.error("Character not found in positionedCharacters:",t),console.log("Current positionedCharacters:",e)),n?n.position:null}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){this.setCursor("default"),e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach((e=>e.call(null)))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach((e=>e.call(null)))}setCursor(e){this.boardEl.style.cursor=e}showError(e){const t=document.getElementById("game-error");t&&(t.textContent=e,setTimeout((()=>t.textContent=""),3e3))}showMessage(e){const t=document.getElementById("game-message");t&&(t.textContent=e,setTimeout((()=>t.textContent=""),3e3))}selectCell(e,t="yellow",n="solid"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`),"dashed"===n&&this.cells[e].classList.add("selected-dashed")}deselectCell(e){this.cells[e].classList.remove("selected","selected-yellow","selected-green","selected-red","selected-dashed")}deselectAllCells(){this.cells.forEach(((e,t)=>this.deselectCell(t)))}hideActionMenu(){document.querySelectorAll(".action-menu").forEach((e=>{try{e.parentNode?.removeChild(e)}catch(e){console.error("Error removing action menu:",e)}}))}showActionMenu(e,t,n="attack"){this.hideActionMenu();const a=document.createElement("div");a.className=`action-menu ${n}-menu`,t.forEach((e=>{const t=document.createElement("button");t.className="action-button",t.textContent=e.text,t.addEventListener("click",(t=>{t.stopPropagation(),e.action()})),a.appendChild(t)})),this.cells[e].appendChild(a)}showAttackRange(e,t){const n=this.findPositionByCharacter(t,e);null!==n&&t.filter((t=>t.character.team!==e.team)).forEach((t=>{e.calculateDistance({x:n%this.boardSize,y:Math.floor(n/this.boardSize)},{x:t.position%this.boardSize,y:Math.floor(t.position/this.boardSize)})<=e.attackDistance&&this.selectCell(t.position,"red","dashed")}))}async showDamage(e,t,n=!1){const a=this.cells[e];if(!a)return;const r=a.querySelector(".damage");r&&a.contains(r)&&a.removeChild(r);const i=document.createElement("div");i.className="damage "+(n?"critical":""),i.textContent=`-${t}`,a.appendChild(i),await new Promise((e=>{i.addEventListener("animationend",(()=>{a.contains(i)&&a.removeChild(i),e()}),{once:!0})}))}showCellTooltip(e,t){const n=this.cells[t];if(!n)return;const a=n.querySelector(".custom-tooltip");a&&n.removeChild(a);const r=document.createElement("div");r.className="custom-tooltip",r.innerHTML=`\n      <span class="character-type">${e}</span>\n    `,n.appendChild(r),n.tooltip=r}removeCellTooltip(e){const t=this.cells[e];if(!t)return;const n=t.querySelector(".custom-tooltip");n&&t.contains(n)&&t.removeChild(n),delete t.tooltip}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}};T.bindToDOM(document.querySelector("#game-container"));const M=new B(localStorage,T),S=new class{constructor(e,t){this.gamePlay=e,this.stateService=t||new B(localStorage,this.gamePlay),this.playerTypes=[x,w,k],this.enemyTypes=[P,L,D],this.maxLevel=4,this.maxCharacters=3,this.characterCount=2,this.playerTeam=[],this.enemyTeam=[],this.positionedPlayerCharacters=[],this.positionedEnemyCharacters=[],this.gameState=new v,this.selectedCharacter=null,this.selectedCellIndex=null,this.isCharacterSelected=!1,this.movingCharacter=null,this.movingPath=[],this.currentLevel=1,this.maxLevel=4,this.themes=["prairie","desert","arctic","mountain"],this.maxScore=0}async checkWinConditions(){const e=this.positionedEnemyCharacters.every((e=>e.character.isDead||e.character.health<=0)),t=this.positionedPlayerCharacters.every((e=>e.character.isDead||e.character.health<=0));if(e){const e=this.calculateScore();return this.maxScore=Math.max(this.maxScore,e),this.currentLevel<this.maxLevel?await this.nextLevel():(this.gamePlay.showMessage(`Поздравляем! Вы прошли все уровни! Максимальный счет: ${this.maxScore}`),this.lockGame()),!0}return!!t&&(this.gamePlay.showMessage(`Игра окончена. Вы проиграли. Максимальный счет: ${this.maxScore}`),this.lockGame(),!0)}async nextLevel(){this.currentLevel++;const e=this.themes[this.currentLevel-1];this.increaseScore(100),this.playerTeam.characters.filter((e=>!e.isDead)).forEach((e=>{const t=e.level+80;e.health=Math.min(t,e.maxHealth);const n=e.health/e.maxHealth*100;n>50?e.defence=Math.round(1.1*e.defence):n>30&&(e.defence=Math.round(1.05*e.defence)),e.levelUp()})),this.gamePlay.showMessage(`Уровень ${this.currentLevel}! Тема: ${e}`),this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}calculateScore(){return this.playerTeam.characters.reduce(((e,t)=>e+10*t.level+t.health),0)}increaseScore(e){this.maxScore+=e,this.updateStats()}lockGame(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.isGameLocked=!0}updateStats(){this.gamePlay.updateStats(this.currentLevel,this.maxScore)}saveGame(){try{const e=new v(this.gameState.currentTurn,this.maxScore,this.currentLevel,this.playerTeam,this.enemyTeam,this.positionedPlayerCharacters,this.positionedEnemyCharacters);this.stateService.save(e)}catch(e){this.gamePlay.showError("Ошибка при сохранении игры"),console.error("Save error:",e)}}async loadGame(){this.isGameLocked=!1;try{const e=this.stateService.load(),t=(e,t)=>e&&e.characters?(e.characters=e.characters.map((e=>{const n=t.find((t=>t.name.toLowerCase()===e.type));if(!n)return e;const a=new n(e.level);return Object.keys(e).forEach((t=>{"actions"!==t&&"moveCost"!==t&&(a[t]=e[t])})),a})),e):e,n=e=>{const t=[...this.playerTypes,...this.enemyTypes].find((t=>t.name.toLowerCase()===e.type));if(t){const n=new t(e.level);e.actions={...n.actions},e.moveCost={...n.moveCost}}};this.maxScore=e.maxScore,this.currentLevel=e.currentLevel,this.gameState.currentTurn=e.currentTurn,this.playerTeam=t(e.playerTeam,this.playerTypes),this.enemyTeam=t(e.enemyTeam,this.enemyTypes),[...this.playerTeam.characters,...this.enemyTeam.characters].forEach(n);const a=(e,t)=>t.map((t=>{const n=e?.characters?.find((e=>e.type===t.character.type&&e.level===t.character.level))||t.character;return new E(n,t.position)}));this.positionedPlayerCharacters=a(this.playerTeam,e.positionedPlayerCharacters),this.positionedEnemyCharacters=a(this.enemyTeam,e.positionedEnemyCharacters);const r=this.themes[this.currentLevel-1];this.gamePlay.drawUi(r),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.redrawTeams(),this.updateTurnIndicator(),this.updateStats(),this.resetCharactersActionPoints(),console.log("Game loaded successfully:",{playerTeam:this.playerTeam,enemyTeam:this.enemyTeam,positionedChars:this.positionedPlayerCharacters})}catch(e){console.error("Load error:",e),this.gamePlay.showError("Не удалось загрузить игру"),this.newGame()}}init(){try{const e=this.themes[this.currentLevel-1];this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.gamePlay.setCursor=e=>{this.gamePlay.boardEl.style.cursor=e},this.gamePlay.setCursor("default")}catch(e){this.gamePlay.showError(e.message)}this.updateTurnIndicator(),this.resetCharactersActionPoints(),this.updateStats()}newGame(){this.currentLevel=1,this.isGameLocked=!1;const e=this.themes[this.currentLevel-1];this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}resetCharactersActionPoints(){this.playerTeam.characters.forEach((e=>{e.isDead||e.resetActionPoints()})),this.enemyTeam.characters.forEach((e=>{e.isDead||e.resetActionPoints()}))}generateTeams(){const e=Math.min(this.characterCount,this.maxCharacters);this.playerTeam=y(this.playerTypes,this.maxLevel,e),this.enemyTeam=y(this.enemyTypes,this.maxLevel,e),this.positionedPlayerCharacters=this.positionCharacters(this.playerTeam.characters,[0,1]),this.positionedEnemyCharacters=this.positionCharacters(this.enemyTeam.characters,[6,7])}positionCharacters(e,t){const n=this.gamePlay.boardSize,a=new Set,r=n*t.length;if(e.length>r)throw new Error(`Недостаточно места для ${e.length} персонажей`);return e.map((e=>{const r=t.flatMap((e=>Array.from({length:n},((t,a)=>a*n+e)))).filter((e=>!a.has(e))),i=r[Math.floor(Math.random()*r.length)];return a.add(i),new E(e,i)}))}redrawTeams(){const e=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.redrawPositions(e)}setupEventListeners(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this))}updateTurnIndicator(){const e=document.getElementById("current-turn");e&&("player"===this.gameState.currentTurn?(e.textContent="Ваш ход",e.className="player-turn"):(e.textContent="Ход противника",e.className="enemy-turn"))}onCellClick(e){if(this.isGameLocked)return void console.warn("Game is locked!");const t=this.getAllCharacters(),n=this.gamePlay.findCharacterByPosition(t,e);n?console.log("Clicked character:",{type:n.type,team:n.team,isDead:n.isDead,proto:Object.getPrototypeOf(n)}):console.log("No character at position",e),n?this.playerTeam.characters.includes(n)?this.selectCharacter(n,e):this.isCharacterSelected&&this.showAttackMenu(this.selectedCharacter,n,e):this.isCharacterSelected&&this.moveCharacter(this.selectedCharacter,e)}onCellEnter(e){const t=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].find((t=>t.position===e));if(t){const n=t.character.isDead?"not-allowed":"pointer";this.gamePlay.setCursor(n),t.character.isDead?this.gamePlay.removeCellTooltip(e):this.gamePlay.showCellTooltip(`${t.character.type} \n (🎖${t.character.level} ⚔${t.character.attack} 🛡${t.character.defence} ❤${t.character.health})`,e)}else this.gamePlay.setCursor("default"),this.gamePlay.removeCellTooltip(e)}onCellLeave(e){this.gamePlay.removeCellTooltip(e),this.gamePlay.setCursor("default")}getAllCharacters(){return[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].filter((e=>!e.character.isDead))}selectCharacter(e,t){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.selectedCharacter=e,this.selectedCellIndex=t,this.isCharacterSelected=!0,this.gamePlay.selectCell(t,"yellow"),this.updateAvailableActions()}updateAvailableActions(){this.selectedCharacter&&(this.showPossibleActions(),this.updateActionPointsDisplay(),this.showDefenceButton(this.selectedCellIndex))}async moveCharacter(e,t){const n=this.selectedCellIndex,a=this.calculatePath(n,t,e.moveDistance);if(!a||!a.includes(t))return this.gamePlay.showMessage("Невозможно переместиться! Персонаж блокирует путь."),!1;const r=this.calculateMoveCost(n,t,e);return r>e.currentActionPoints?(this.gamePlay.showError("Недостаточно очков действий!"),!1):(await this.animateMovement(e,a),e.currentActionPoints-=r,this.selectedCellIndex=t,this.updateCharacterPosition(e,t),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn(),!0)}calculateMoveCost(e,t,n){const a=this.indexToPosition(e),r=this.indexToPosition(t),i=Math.abs(a.x-r.x),o=Math.abs(a.y-r.y),s=i>0&&o>0,c=Math.max(i,o);return"magician"===n.type||"daemon"===n.type?c*(s?3:2):c*(s?2:1)}calculatePath(e,t,n){if(e===t)return[e];const a=this.gamePlay.boardSize,r=this.indexToPosition(e),i=this.indexToPosition(t),o=[e];let s={...r},c=0;for(;c<n&&(s.x!==i.x||s.y!==i.y);){s.x<i.x?s.x++:s.x>i.x&&s.x--,s.y<i.y?s.y++:s.y>i.y&&s.y--;const e=s.y*a+s.x;if(this.gamePlay.findCharacterByPosition([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e))break;o.push(e),c++}return o}async animateMovement(e,t){const n=e.type;e.type="moving";for(let n=1;n<t.length;n++){const a=t[n];this.updateCharacterPosition(e,a),this.redrawTeams(),await new Promise((e=>setTimeout(e,200)))}e.type=n}updateCharacterPosition(e,t){console.log(`Updating position for ${e.type} to ${t}`),this.playerTeam.characters.includes(e)?this.positionedPlayerCharacters=this.positionedPlayerCharacters.map((n=>n.character===e?new E(e,t):n)):this.positionedEnemyCharacters=this.positionedEnemyCharacters.map((n=>n.character===e?new E(e,t):n));const n=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);console.assert(n===t,`Position update failed for ${e.type}! Expected ${t}, got ${n}`)}showAttackMenu(e,t,n){const a=[];e.currentActionPoints>=1&&a.push({text:"Атака (1 очко)",action:()=>this.performAttack(e,t,n,"attack")}),e.currentActionPoints>=2&&a.push({text:"Сильная атака (2 очка)",action:()=>this.performAttack(e,t,n,"hardAttack")}),this.gamePlay.showActionMenu(n,a,"attack")}showDefenceButton(e){if(!this.selectedCharacter?.currentActionPoints)return;const t=[{text:`Защита (${this.selectedCharacter.currentActionPoints} очков)`,action:()=>this.performDefence(this.selectedCharacter)}];this.gamePlay.showActionMenu(e,t,"defence")}getPossibleMoves(e,t){const n=this.gamePlay.boardSize,a=[];for(let r=0;r<n;r++)for(let i=0;i<n;i++){const o=r*n+i;if(Math.abs(Math.floor(e/n)-r)+Math.abs(e%n-i)<=t&&o!==e){const e=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.findCharacterByPosition(e,o)||a.push(o)}}return a}getPossibleAttacks(e,t){const n=this.gamePlay.boardSize,a=[],r="player"===this.gameState.currentTurn?this.positionedEnemyCharacters:this.positionedPlayerCharacters;for(let i=0;i<n;i++)for(let o=0;o<n;o++){const s=i*n+o,c=Math.abs(Math.floor(e/n)-i),l=Math.abs(e%n-o);c<=t&&l<=t&&s!==e&&this.gamePlay.findCharacterByPosition(r,s)&&a.push(s)}return a}showPossibleActions(){if(!this.selectedCharacter)return;this.gamePlay.deselectAllCells();const e=this.gamePlay.findPositionByCharacter(this.positionedPlayerCharacters,this.selectedCharacter);if(null===e)return;this.gamePlay.selectCell(e,"yellow");const t=Math.min(this.selectedCharacter.moveDistance,this.selectedCharacter.currentActionPoints);t>0&&this.getPossibleMoves(e,t).forEach((e=>this.gamePlay.selectCell(e,"green"))),this.getPossibleAttacks(e,this.selectedCharacter.attackDistance).forEach((e=>this.gamePlay.selectCell(e,"red")))}async performAttack(e,t,n,a){if(!e)return void console.error("Attacker is undefined");const r=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);if(null===r)return console.error("Attacker position not found:",e),void this.gamePlay.showError(`${e.type}: Не могу найти позицию атакующего!`);if(e.calculateDistance(this.indexToPosition(r),this.indexToPosition(n))>e.attackDistance)return void("player"===e.team&&this.gamePlay.showError("Враг слишком далеко!"));const i="attack"===a?1:2;if(e.currentActionPoints<i)return void this.gamePlay.showError("Недостаточно очков действий!");const o=e.actions[a](),s=Math.round(o.damage);await this.gamePlay.showDamage(n,s,o.isCritical),t.takeDamage(s),e.currentActionPoints-=o.cost,this.gamePlay.hideActionMenu(),this.redrawTeams(),t.health<=0&&this.handleCharacterDeath(t),this.checkTurnEnd()&&this.switchTurn()}handleCharacterDeath(e){e.die(),this.gamePlay.showMessage(`${e.type} погиб!`),this.redrawTeams(),this.checkWinConditions()}performDefence(e){const t=5*e.currentActionPoints;e.defence+=t,e.currentActionPoints=0,this.gamePlay.showMessage(`${e.type} усилил защиту на ${t} очков!`),this.gamePlay.hideActionMenu(),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn()}indexToPosition(e){const t=this.gamePlay.boardSize;return{x:e%t,y:Math.floor(e/t)}}updateActionPointsDisplay(){const e=document.getElementById("action-points");if(!e)return;let t="<h3>Очки действий:</h3>";this.playerTeam.characters.forEach((e=>{t+=`<p>${e.type}: ${e.currentActionPoints}/${e.actionPoints}</p>`})),e.innerHTML=t}checkTurnEnd(){return this.playerTeam.characters.filter((e=>!e.isDead)).every((e=>e.currentActionPoints<=0))}async switchTurn(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),"player"===this.gameState.currentTurn?this.enemyTeam.characters.forEach((e=>e.resetActionPoints())):this.playerTeam.characters.forEach((e=>e.resetActionPoints())),this.gameState.currentTurn="player"===this.gameState.currentTurn?"enemy":"player",this.updateTurnIndicator(),"enemy"!==this.gameState.currentTurn||this.isGameLocked||await this.makeEnemyMove()}async makeEnemyMove(){if(console.log("Starting enemy move. Current positions:",{players:this.positionedPlayerCharacters.map((e=>`${e.character.type}:${e.position}`)),enemies:this.positionedEnemyCharacters.map((e=>`${e.character.type}:${e.position}`))}),!await this.checkWinConditions())try{const e=this.positionedEnemyCharacters.filter((e=>!e.character.isDead&&e.character.currentActionPoints>0)).sort(((e,t)=>t.character.attackDistance-e.character.attackDistance));for(const t of e){const e=t.character,n=t.position,a=this.positionedPlayerCharacters.filter((e=>!e.character.isDead)).map((t=>({character:t.character,position:t.position,distance:e.calculateDistance(this.indexToPosition(n),this.indexToPosition(t.position))})));if(0===a.length)continue;const r=a.sort(((e,t)=>e.distance===t.distance?e.character.health-t.character.health:e.distance-t.distance)),i=r.filter((t=>t.distance<=e.attackDistance));if(i.length>0){if(await this.performAttack(e,i[0].character,i[0].position,"attack"),await this.checkWinConditions())return;continue}const o=r[0],s=this.calculatePath(n,o.position,e.moveDistance);if(s&&s.length>1){const t=s[Math.min(s.length-1,e.moveDistance)];if(this.calculateMoveCost(n,t,e)<=e.currentActionPoints&&(await this.moveEnemyCharacter(e,t),await this.checkWinConditions()))return}}}catch(e){console.error("AI move error:",e)}finally{this.switchTurn()}}getAttackTargets(e,t,n){return n.filter((n=>e.calculateDistance(this.indexToPosition(t),this.indexToPosition(n.position))<=e.attackDistance))}async moveTowardsNearestPlayer(e,t,n){const a=n.reduce(((n,a)=>{const r=e.calculateDistance(this.indexToPosition(t),this.indexToPosition(n.position));return e.calculateDistance(this.indexToPosition(t),this.indexToPosition(a.position))<r?a:n})),r=this.calculatePath(t,a.position,e.moveDistance);if(r&&r.length>1){const t=r[Math.min(r.length-1,e.moveDistance)];await this.moveEnemyCharacter(e,t)}}async moveEnemyCharacter(e,t){try{const n=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);if(null===n||"number"!=typeof n)return console.error("Cannot find character position before move:",e),!1;const a=this.calculatePath(n,t,e.moveDistance);if(!a||!a.includes(t))return!1;const r=this.calculateMoveCost(n,t,e);return!(r>e.currentActionPoints||(await this.animateMovement(e,a),e.currentActionPoints-=r,this.updateCharacterPosition(e,t),this.redrawTeams(),0))}catch(e){return console.error("Error in moveEnemyCharacter:",e),!1}}findPositionByCharacter(e,t){const n=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],a=n.find((e=>e.character===t));return a||console.error("Character not found:",{character:t,allPositionedChars:n.map((e=>({type:e.character.type,position:e.position,isDead:e.character.isDead})))}),a?a.position:null}}(T,M);S.init()}();
//# sourceMappingURL=bundle.js.map