!function(){"use strict";var t={186:function(t,e,r){t.exports=r.p+"assets/2429af6d3a5796e3c34b.png"},227:function(t,e,r){t.exports=r.p+"assets/265b078c3f89d3c80dbb.png"},540:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},756:function(t,e,r){t.exports=r.p+"assets/37f8b2da9e57f436ca05.png"},942:function(t,e,r){t.exports=r.p+"assets/d868a744c00bd9f13c08.png"},1016:function(t,e,r){var n=r(1354),a=r.n(n),i=r(6314),o=r.n(i),s=r(4417),c=r.n(s),l=new URL(r(7935),r.b),h=new URL(r(1409),r.b),A=new URL(r(3232),r.b),d=new URL(r(1265),r.b),p=new URL(r(6267),r.b),m=new URL(r(186),r.b),u=new URL(r(9745),r.b),g=new URL(r(8490),r.b),C=new URL(r(2573),r.b),f=new URL(r(4496),r.b),E=new URL(r(8956),r.b),b=new URL(r(9221),r.b),y=new URL(r(6092),r.b),v=new URL(r(4184),r.b),B=new URL(r(5513),r.b),x=new URL(r(3062),r.b),w=new URL(r(4875),r.b),k=new URL(r(5134),r.b),P=new URL(r(7335),r.b),L=new URL(r(6153),r.b),D=new URL(r(9e3),r.b),T=new URL(r(9593),r.b),M=new URL(r(5523),r.b),S=new URL(r(7986),r.b),U=new URL(r(4041),r.b),z=new URL(r(7538),r.b),G=new URL(r(1605),r.b),R=new URL(r(6318),r.b),$=new URL(r(3933),r.b),N=new URL(r(6291),r.b),q=new URL(r(9702),r.b),j=new URL(r(1906),r.b),I=new URL(r(4347),r.b),Y=new URL(r(1216),r.b),X=new URL(r(4437),r.b),O=new URL(r(3160),r.b),H=new URL(r(8782),r.b),W=new URL(r(2076),r.b),Z=new URL(r(3860),r.b),F=new URL(r(6943),r.b),J=new URL(r(6168),r.b),Q=new URL(r(227),r.b),K=new URL(r(756),r.b),_=new URL(r(9334),r.b),V=new URL(r(942),r.b),tt=o()(a()),et=c()(l),rt=c()(h),nt=c()(A),at=c()(d),it=c()(p),ot=c()(m),st=c()(u),ct=c()(g),lt=c()(C),ht=c()(f),At=c()(E),dt=c()(b),pt=c()(y),mt=c()(v),ut=c()(B),gt=c()(x),Ct=c()(w),ft=c()(k),Et=c()(P),bt=c()(L),yt=c()(D),vt=c()(T),Bt=c()(M),xt=c()(S),wt=c()(U),kt=c()(z),Pt=c()(G),Lt=c()(R),Dt=c()($),Tt=c()(N),Mt=c()(q),St=c()(j),Ut=c()(I),zt=c()(Y),Gt=c()(X),Rt=c()(O),$t=c()(H),Nt=c()(W),qt=c()(Z),jt=c()(F),It=c()(J),Yt=c()(Q),Xt=c()(K),Ot=c()(_),Ht=c()(V);tt.push([t.id,":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n  cursor: pointer;\r\n\r\n  &:hover {\r\n    background-color:rgb(195, 197, 199);\r\n    transition: color 0.2s;\r\n  }\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.game-info {\r\n  background-color: #000;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n.turn-indicator {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.game-message {\r\n  color: #4CAF50;\r\n  min-height: 20px;\r\n}\r\n\r\n.game-error {\r\n  color: #F44336;\r\n  min-height: 20px;\r\n}\r\n\r\n#game-board {\r\n  margin-top: 20px;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell:hover {\r\n  cursor: default;\r\n}\r\n\r\n.cell:hover .custom-tooltip {\r\n  display: block;\r\n}\r\n\r\n.custom-tooltip {\r\n  position: absolute;\r\n  z-index: 9999;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  border-radius: 4px;\r\n  min-width: 250px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n  font-size: 10px;\r\n  pointer-events: none;\r\n  display: flex; \r\n}\r\n\r\n\r\n.custom-tooltip .character-type {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url("+et+");\r\n  --map-tile-top-url: url("+rt+");\r\n  --map-tile-top-right-url: url("+nt+");\r\n  --map-tile-bottom-left-url: url("+at+");\r\n  --map-tile-bottom-url: url("+it+");\r\n  --map-tile-bottom-right-url: url("+ot+");\r\n  --map-tile-left-url: url("+st+");\r\n  --map-tile-right-url: url("+ct+");\r\n  --map-tile-center-url: url("+lt+");\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url("+ht+");\r\n  --map-tile-top-url: url("+At+");\r\n  --map-tile-top-right-url: url("+dt+");\r\n  --map-tile-bottom-left-url: url("+pt+");\r\n  --map-tile-bottom-url: url("+mt+");\r\n  --map-tile-bottom-right-url: url("+ut+");\r\n  --map-tile-left-url: url("+gt+");\r\n  --map-tile-right-url: url("+Ct+");\r\n  --map-tile-center-url: url("+ft+");\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url("+Et+");\r\n  --map-tile-top-url: url("+bt+");\r\n  --map-tile-top-right-url: url("+yt+");\r\n  --map-tile-bottom-left-url: url("+vt+");\r\n  --map-tile-bottom-url: url("+Bt+");\r\n  --map-tile-bottom-right-url: url("+xt+");\r\n  --map-tile-left-url: url("+wt+");\r\n  --map-tile-right-url: url("+kt+");\r\n  --map-tile-center-url: url("+Pt+");\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url("+Lt+");\r\n  --map-tile-top-url: url("+Dt+");\r\n  --map-tile-top-right-url: url("+Tt+");\r\n  --map-tile-bottom-left-url: url("+Mt+");\r\n  --map-tile-bottom-url: url("+St+");\r\n  --map-tile-bottom-right-url: url("+Ut+");\r\n  --map-tile-left-url: url("+zt+");\r\n  --map-tile-right-url: url("+Gt+");\r\n  --map-tile-center-url: url("+Rt+");\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 1001;\r\n}\r\n\r\n.character.moving {\r\n  background: url("+$t+");\r\n}\r\n\r\n.character.bowman {\r\n  background: url("+Nt+");\r\n}\r\n\r\n.character.daemon {\r\n  background: url("+qt+");\r\n}\r\n\r\n.character.magician {\r\n  background: url("+jt+");\r\n}\r\n\r\n.character.swordsman {\r\n  background: url("+It+");\r\n}\r\n\r\n.character.undead {\r\n  background: url("+Yt+");\r\n}\r\n\r\n.character.vampire {\r\n  background: url("+Xt+");\r\n}\r\n\r\n.character.zombie {\r\n  background: url("+Ot+");\r\n}\r\n\r\n.character.dead {\r\n  background: url("+Ht+");\r\n  opacity: 0.7;\r\n  filter: grayscale(70%);\r\n  pointer-events: none;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.character:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n.character.dead:hover {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n// Меню выбора действий\r\n\r\n.action-menu {\r\n  z-index: 1002;\r\n  position: absolute;\r\n  background: rgba(0, 0, 0, 0.9);\r\n}\r\n\r\n.attack-menu {\r\n  left: 100%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.defence-menu {\r\n  left: 50%;\r\n  bottom: -50%;\r\n  transform: translateX(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.resurrect-menu {\r\n  left: 50%;\r\n  top: -50%;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.action-button {\r\n  background: #333;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  margin: 2px;\r\n  cursor: pointer;\r\n  border-radius: 3px;\r\n  text-align: left;\r\n  white-space: nowrap;\r\n}\r\n\r\n.action-button:hover {\r\n  background: #555;\r\n}\r\n\r\n// анимация перемещения\r\n\r\n.character.moving {\r\n  transition: transform 0.2s ease-in-out;\r\n  transform: scale(1.1);\r\n  filter: brightness(1.2);\r\n}\r\n\r\n#action-points {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 5px;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n#action-points h3 {\r\n  margin: 0 0 5px 0;\r\n  font-size: 1em;\r\n}\r\n\r\n#action-points p {\r\n  margin: 2px 0;\r\n  font-size: 0.9em;\r\n}\r\n\r\n/* Анимация урона */\r\n.damage {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  color: #ff0;\r\n  font-weight: bold;\r\n  font-size: 1.2em;\r\n  z-index: 2000;\r\n  pointer-events: none;\r\n  text-shadow: 0 0 3px black;\r\n  will-change: transform, opacity;\r\n  animation: damageAnimation 1s forwards;\r\n}\r\n\r\n.damage.critical {\r\n  color: red;\r\n  animation: criticalHit 1s forwards;\r\n  z-index: 2000;\r\n}\r\n\r\n@keyframes damageAnimation {\r\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\r\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\r\n}\r\n\r\n@keyframes criticalHit {\r\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\r\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\r\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\r\n}\r\n\r\n/* Меню статиситки игры */\r\n\r\n#game-stats {\r\n  display: block;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n\r\n}\r\n\r\n","",{version:3,sources:["webpack://./src/css/style.css"],names:[],mappings:"AAAA;EACE,iBAAiB;AACnB;;AAEA;EACE,YAAY;EACZ,SAAS;AACX;;AAEA;EACE,gBAAgB;EAChB,eAAe;AACjB;;AAEA;EACE,qBAAqB;EACrB,gBAAgB;EAChB,cAAc;EACd,yBAAyB;EACzB,kBAAkB;EAClB,sBAAsB;EACtB,uBAAuB;EACvB,eAAe;EACf,gBAAgB;EAChB,qBAAqB;EACrB,8HAA8H;EAC9H,YAAY;EACZ,eAAe;;EAEf;IACE,mCAAmC;IACnC,sBAAsB;EACxB;AACF;;AAEA;EACE,kBAAkB;EAClB,cAAc;AAChB;;AAEA;EACE,sBAAsB;EACtB,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;AACvC;;AAEA;EACE,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,cAAc;EACd,gBAAgB;AAClB;;AAEA;EACE,cAAc;EACd,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,eAAe;AACjB;;AAEA;EACE,aAAa;EACb,qCAAqC;EACrC,oBAAoB;EACpB,iBAAiB;AACnB;;AAEA;EACE,kBAAkB;AACpB;;AAEA;EACE,WAAW;EACX,cAAc;EACd,WAAW;EACX,mBAAmB;EACnB,sBAAsB;EACtB,uBAAuB;EACvB,wBAAwB;EACxB,YAAY;EACZ,kBAAkB;AACpB;;AAEA;EACE,kBAAkB;EAClB,mBAAmB;EACnB,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,oBAAoB;EACpB,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,aAAa;EACb,YAAY;EACZ,SAAS;EACT,2BAA2B;EAC3B,oCAAoC;EACpC,YAAY;EACZ,kBAAkB;EAClB,gBAAgB;EAChB,kBAAkB;EAClB,qCAAqC;EACrC,eAAe;EACf,oBAAoB;EACpB,aAAa;AACf;;;AAGA;EACE,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,gEAAoE;EACpE,2DAA0D;EAC1D,iEAAsE;EACtE,mEAA0E;EAC1E,8DAAgE;EAChE,oEAA4E;EAC5E,4DAA4D;EAC5D,6DAA8D;EAC9D,8DAAgE;AAClE;;AAEA;EACE,gEAAmE;EACnE,4DAAyD;EACzD,kEAAqE;EACrE,oEAAyE;EACzE,+DAA+D;EAC/D,qEAA2E;EAC3E,6DAA2D;EAC3D,8DAA6D;EAC7D,+DAA+D;AACjE;;AAEA;EACE,iEAAmE;EACnE,4DAAyD;EACzD,kEAAqE;EACrE,oEAAyE;EACzE,+DAA+D;EAC/D,qEAA2E;EAC3E,6DAA2D;EAC3D,8DAA6D;EAC7D,+DAA+D;AACjE;;AAEA;EACE,iEAAqE;EACrE,4DAA2D;EAC3D,kEAAuE;EACvE,oEAA2E;EAC3E,+DAAiE;EACjE,qEAA6E;EAC7E,6DAA6D;EAC7D,8DAA+D;EAC/D,+DAAiE;AACnE;;AAEA;EACE,uBAAuB;EACvB,wBAAwB;AAC1B;;AAEA;EACE,wCAAwC;AAC1C;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,yCAAyC;AAC3C;;AAEA;EACE,2CAA2C;AAC7C;;AAEA;EACE,sCAAsC;AACxC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,oCAAoC;AACtC;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sCAAsC;AACxC;;AAEA;EACE,uBAAuB;EACvB,wBAAwB;EACxB,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAAiD;AACnD;;AAEA;EACE,oDAAkD;AACpD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAAgD;AAClD;;AAEA;EACE,oDAA+C;AACjD;;AAEA;EACE,oDAA6C;EAC7C,YAAY;EACZ,sBAAsB;EACtB,oBAAoB;EACpB,mBAAmB;AACrB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,QAAQ;EACR,SAAS;EACT,kBAAkB;EAClB,WAAW;EACX,WAAW;EACX,gBAAgB;AAClB;;AAEA;EACE,WAAW;AACb;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;;;EAGE,aAAa;EACb,kBAAkB;EAClB,8BAA8B;AAChC;;AAEA;EACE,UAAU;EACV,QAAQ;EACR,2BAA2B;EAC3B,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,SAAS;EACT,YAAY;EACZ,2BAA2B;EAC3B,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,SAAS;EACT,SAAS;EACT,2BAA2B;AAC7B;;AAEA;EACE,gBAAgB;EAChB,YAAY;EACZ,YAAY;EACZ,iBAAiB;EACjB,WAAW;EACX,eAAe;EACf,kBAAkB;EAClB,gBAAgB;EAChB,mBAAmB;AACrB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;;;EAGE,sCAAsC;EACtC,qBAAqB;EACrB,uBAAuB;AACzB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,8BAA8B;EAC9B,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;AACvC;;AAEA;EACE,iBAAiB;EACjB,cAAc;AAChB;;AAEA;EACE,aAAa;EACb,gBAAgB;AAClB;;AAEA,mBAAmB;AACnB;EACE,kBAAkB;EAClB,MAAM;EACN,SAAS;EACT,2BAA2B;EAC3B,WAAW;EACX,iBAAiB;EACjB,gBAAgB;EAChB,aAAa;EACb,oBAAoB;EACpB,0BAA0B;EAC1B,+BAA+B;EAC/B,sCAAsC;AACxC;;AAEA;EACE,UAAU;EACV,kCAAkC;EAClC,aAAa;AACf;;AAEA;EACE,KAAK,kDAAkD,EAAE,UAAU,EAAE;EACrE,OAAO,yDAAyD,EAAE,UAAU,EAAE;AAChF;;AAEA;EACE,KAAK,oCAAoC,EAAE,UAAU,EAAE;EACvD,MAAM,oCAAoC,EAAE,UAAU,EAAE;EACxD,OAAO,sCAAsC,EAAE,UAAU,EAAE;AAC7D;;AAEA,yBAAyB;;AAEzB;EACE,cAAc;EACd,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,qCAAqC;;AAEvC",sourcesContent:[":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n  cursor: pointer;\r\n\r\n  &:hover {\r\n    background-color:rgb(195, 197, 199);\r\n    transition: color 0.2s;\r\n  }\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.game-info {\r\n  background-color: #000;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n.turn-indicator {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.game-message {\r\n  color: #4CAF50;\r\n  min-height: 20px;\r\n}\r\n\r\n.game-error {\r\n  color: #F44336;\r\n  min-height: 20px;\r\n}\r\n\r\n#game-board {\r\n  margin-top: 20px;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell:hover {\r\n  cursor: default;\r\n}\r\n\r\n.cell:hover .custom-tooltip {\r\n  display: block;\r\n}\r\n\r\n.custom-tooltip {\r\n  position: absolute;\r\n  z-index: 9999;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  border-radius: 4px;\r\n  min-width: 250px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n  font-size: 10px;\r\n  pointer-events: none;\r\n  display: flex; \r\n}\r\n\r\n\r\n.custom-tooltip .character-type {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url('../img/prairie/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/prairie/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/prairie/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/prairie/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/prairie/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/prairie/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/prairie/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/prairie/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/prairie/map-tile-center.png');\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url('../img/desert/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/desert/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/desert/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/desert/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/desert/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/desert/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/desert/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/desert/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/desert/map-tile-center.png');\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url('../img/arctic/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/arctic/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/arctic/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/arctic/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/arctic/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/arctic/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/arctic/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/arctic/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/arctic/map-tile-center.png');\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url('../img/mountain/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/mountain/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/mountain/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/mountain/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/mountain/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/mountain/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/mountain/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/mountain/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/mountain/map-tile-center.png');\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 1001;\r\n}\r\n\r\n.character.moving {\r\n  background: url('../img/characters/moving.png');\r\n}\r\n\r\n.character.bowman {\r\n  background: url('../img/characters/bowman.png');\r\n}\r\n\r\n.character.daemon {\r\n  background: url('../img/characters/daemon.png');\r\n}\r\n\r\n.character.magician {\r\n  background: url('../img/characters/magician.png');\r\n}\r\n\r\n.character.swordsman {\r\n  background: url('../img/characters/swordsman.png');\r\n}\r\n\r\n.character.undead {\r\n  background: url('../img/characters/undead.png');\r\n}\r\n\r\n.character.vampire {\r\n  background: url('../img/characters/vampire.png');\r\n}\r\n\r\n.character.zombie {\r\n  background: url('../img/characters/zombie.png');\r\n}\r\n\r\n.character.dead {\r\n  background: url('../img/characters/dead.png');\r\n  opacity: 0.7;\r\n  filter: grayscale(70%);\r\n  pointer-events: none;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.character:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n.character.dead:hover {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n// Меню выбора действий\r\n\r\n.action-menu {\r\n  z-index: 1002;\r\n  position: absolute;\r\n  background: rgba(0, 0, 0, 0.9);\r\n}\r\n\r\n.attack-menu {\r\n  left: 100%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.defence-menu {\r\n  left: 50%;\r\n  bottom: -50%;\r\n  transform: translateX(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.resurrect-menu {\r\n  left: 50%;\r\n  top: -50%;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.action-button {\r\n  background: #333;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  margin: 2px;\r\n  cursor: pointer;\r\n  border-radius: 3px;\r\n  text-align: left;\r\n  white-space: nowrap;\r\n}\r\n\r\n.action-button:hover {\r\n  background: #555;\r\n}\r\n\r\n// анимация перемещения\r\n\r\n.character.moving {\r\n  transition: transform 0.2s ease-in-out;\r\n  transform: scale(1.1);\r\n  filter: brightness(1.2);\r\n}\r\n\r\n#action-points {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 5px;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n#action-points h3 {\r\n  margin: 0 0 5px 0;\r\n  font-size: 1em;\r\n}\r\n\r\n#action-points p {\r\n  margin: 2px 0;\r\n  font-size: 0.9em;\r\n}\r\n\r\n/* Анимация урона */\r\n.damage {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  color: #ff0;\r\n  font-weight: bold;\r\n  font-size: 1.2em;\r\n  z-index: 2000;\r\n  pointer-events: none;\r\n  text-shadow: 0 0 3px black;\r\n  will-change: transform, opacity;\r\n  animation: damageAnimation 1s forwards;\r\n}\r\n\r\n.damage.critical {\r\n  color: red;\r\n  animation: criticalHit 1s forwards;\r\n  z-index: 2000;\r\n}\r\n\r\n@keyframes damageAnimation {\r\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\r\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\r\n}\r\n\r\n@keyframes criticalHit {\r\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\r\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\r\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\r\n}\r\n\r\n/* Меню статиситки игры */\r\n\r\n#game-stats {\r\n  display: block;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n\r\n}\r\n\r\n"],sourceRoot:""}]),e.A=tt},1113:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1216:function(t,e,r){t.exports=r.p+"assets/c75f062dddba6e98fdc6.png"},1265:function(t,e,r){t.exports=r.p+"assets/26b5f224d8750119922d.png"},1354:function(t){t.exports=function(t){var e=t[1],r=t[3];if(!r)return e;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),i="/*# ".concat(a," */");return[e].concat([i]).join("\n")}return[e].join("\n")}},1409:function(t,e,r){t.exports=r.p+"assets/946aeb948db6313f1d85.png"},1605:function(t,e,r){t.exports=r.p+"assets/246277b8ca590816b3e8.png"},1906:function(t,e,r){t.exports=r.p+"assets/f462d2ed6eedca1e4fd9.png"},2076:function(t,e,r){t.exports=r.p+"assets/58480938b9b9c149761d.png"},2573:function(t,e,r){t.exports=r.p+"assets/0089a610e6611f679b50.png"},3062:function(t,e,r){t.exports=r.p+"assets/eb1f6e4f87b977012684.png"},3160:function(t,e,r){t.exports=r.p+"assets/6f6f7c09bde970b2e41b.png"},3232:function(t,e,r){t.exports=r.p+"assets/0ac7f8258ec7166dc957.png"},3860:function(t,e,r){t.exports=r.p+"assets/884da1ccd25db8dd2ba4.png"},3933:function(t,e,r){t.exports=r.p+"assets/8b928c3eb136543e573a.png"},4041:function(t,e,r){t.exports=r.p+"assets/3d9503e0a850fda86f82.png"},4184:function(t,e,r){t.exports=r.p+"assets/f1703771380a9959d979.png"},4347:function(t,e,r){t.exports=r.p+"assets/6bacb8e25ed9ecf726bf.png"},4417:function(t){t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},4437:function(t,e,r){t.exports=r.p+"assets/26fdc25019c24e87f11a.png"},4496:function(t,e,r){t.exports=r.p+"assets/258d884122fabfc2f312.png"},4875:function(t,e,r){t.exports=r.p+"assets/2c19971f327b288278bb.png"},5056:function(t,e,r){t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},5072:function(t){var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var i={},o=[],s=0;s<t.length;s++){var c=t[s],l=n.base?c[0]+n.base:c[0],h=i[l]||0,A="".concat(l," ").concat(h);i[l]=h+1;var d=r(A),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var m=a(p,n);n.byIndex=s,e.splice(s,0,{identifier:A,updater:m,references:1})}o.push(A)}return o}function a(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,a){var i=n(t=t||[],a=a||{});return function(t){t=t||[];for(var o=0;o<i.length;o++){var s=r(i[o]);e[s].references--}for(var c=n(t,a),l=0;l<i.length;l++){var h=r(i[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}i=c}}},5134:function(t,e,r){t.exports=r.p+"assets/51e2a5de56bd631452fe.png"},5513:function(t,e,r){t.exports=r.p+"assets/5cf9c17d6a1ea7106a6c.png"},5523:function(t,e,r){t.exports=r.p+"assets/63aae58e4690953a3857.png"},6092:function(t,e,r){t.exports=r.p+"assets/13edb269e39172ddd74f.png"},6153:function(t,e,r){t.exports=r.p+"assets/e0aa3daf6d08c62c96d9.png"},6168:function(t,e,r){t.exports=r.p+"assets/0d75fae43e9f1e48f836.png"},6267:function(t,e,r){t.exports=r.p+"assets/07d5e8127645225478b6.png"},6291:function(t,e,r){t.exports=r.p+"assets/a1d2321024649b9d8f5f.png"},6314:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,a,i){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(o[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);n&&o[h[0]]||(void 0!==i&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=i),r&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=r):h[2]=r),a&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=a):h[4]="".concat(a)),e.push(h))}},e}},6318:function(t,e,r){t.exports=r.p+"assets/ef1b0ea8c4e545d9aadc.png"},6943:function(t,e,r){t.exports=r.p+"assets/d005033b17a1141e4a23.png"},7335:function(t,e,r){t.exports=r.p+"assets/eab6a2cc5e89a4dd8e3f.png"},7538:function(t,e,r){t.exports=r.p+"assets/22e7c5ede3f747cbe27a.png"},7659:function(t){var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},7825:function(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,a&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var i=r.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},7935:function(t,e,r){t.exports=r.p+"assets/46d63299c3420c030b4e.png"},7986:function(t,e,r){t.exports=r.p+"assets/ac9d74f57639792774bc.png"},8490:function(t,e,r){t.exports=r.p+"assets/6a84ae91f5d985ddc9ee.png"},8782:function(t,e,r){t.exports=r.p+"assets/0a77fc47d727eab6fd39.png"},8956:function(t,e,r){t.exports=r.p+"assets/dc3f97e7bbcd5ea1ded9.png"},9e3:function(t,e,r){t.exports=r.p+"assets/d31d84c693f649766aee.png"},9221:function(t,e,r){t.exports=r.p+"assets/2f1e1970c2c20cf3a8d5.png"},9334:function(t,e,r){t.exports=r.p+"assets/296dfeac15e2377fc1dc.png"},9593:function(t,e,r){t.exports=r.p+"assets/b27323cf850ed820855c.png"},9702:function(t,e,r){t.exports=r.p+"assets/1d70f1dab2dd418c3612.png"},9745:function(t,e,r){t.exports=r.p+"assets/546abb060a0837550fd1.png"}},e={};function r(n){var a=e[n];if(void 0!==a)return a.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,r),i.exports}r.m=t,r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&(!t||!/^http(s?):/.test(t));)t=n[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t}(),r.b=document.baseURI||self.location.href,r.nc=void 0;var n=r(5072),a=r.n(n),i=r(7825),o=r.n(i),s=r(7659),c=r.n(s),l=r(5056),h=r.n(l),A=r(540),d=r.n(A),p=r(1113),m=r.n(p),u=r(1016),g={};function C(t,e){const r=e-1,n=e*e-1,a=n-(e-1);return 0===t?"top-left":t===r?"top-right":t===a?"bottom-left":t===n?"bottom-right":t<r?"top":t>a?"bottom":t%e===0?"left":t%e===e-1?"right":"center"}g.styleTagTransform=m(),g.setAttributes=h(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d(),a()(u.A,g),u.A&&u.A.locals&&u.A.locals;class f{constructor(t,e="moving"){if("number"!=typeof t||t<1)throw new Error("Level must be a positive number");this.level=t,this.health=50,this.maxHealth=100,this.type=e,this.moveDistance=1,this.attackDistance=1,this.actionPoints=4,this.currentActionPoints=4,this.team="player",this.isDead=!1;for(let e=1;e<t;e++)this.levelUp();this.actions={attack:()=>({damage:10,cost:1}),hardAttack:()=>({damage:15,cost:2}),defence:()=>({defence:2*this.defence,cost:this.currentActionPoints}),resurrect:()=>({health:this.maxHealth/2,cost:2})},this.moveCost={straight:1,diagonal:1}}levelUp(){this.level++;const t=this.health+80;this.health=Math.min(t,this.maxHealth);const e=(80+this.health/this.maxHealth*100)/100;"number"==typeof this.attack&&(this.attack=Math.max(this.attack,Math.round(this.attack*e))),"number"==typeof this.defence&&(this.defence=Math.max(this.defence,Math.round(this.defence*e))),this.resetActionPoints()}calculateDistance(t,e){const r=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return Math.max(r,n)}canAttack(t){return this.calculateDistance(this.position,t)<=this.attackDistance}getMoveCost(t,e,r){const n=t%r;return Math.floor(t/r)!==Math.floor(e/r)&&n!==e%r?this.moveCost.diagonal:this.moveCost.straight}resetActionPoints(){this.currentActionPoints=this.actionPoints}takeDamage(t){return this.health-=t,this.health<=0&&this.die(),this.health}die(){this.isDead=!0,this.health=0,this.currentActionPoints=0}}class E{constructor(t,e){if(!(t instanceof f))throw new Error("character must be instance of Character or its children");if("number"!=typeof e)throw new Error("position must be a number");this.character=t,this.position=e}}class b{constructor(t=[]){this.characters=t}}function y(t,e,r){const n=function*(t,e){for(;;){const r=t[Math.floor(Math.random()*t.length)],n=Math.floor(Math.random()*e)+1;yield new r(n)}}(t,e),a=[];for(let t=0;t<r;t++)a.push(n.next().value);return new b(a)}class v{static from(t){return new v(t.currentTurn,t.maxScore,t.currentLevel,t.playerTeam,t.enemyTeam,t.positionedPlayerCharacters,t.positionedEnemyCharacters)}constructor(t="player",e=0,r=1,n=null,a=null,i=[],o=[]){this.currentTurn=t,this.maxScore=e,this.currentLevel=r,this.playerTeam=n,this.enemyTeam=a,this.positionedPlayerCharacters=i,this.positionedEnemyCharacters=o}serialize(){const t=e=>{if(Array.isArray(e))return e.map((e=>t(e)));if(e instanceof E)return{character:t(e.character),position:e.position};if(e instanceof f){const t={};return t.type=e.type,Object.keys(e).forEach((r=>{"function"!=typeof e[r]&&"actions"!==r&&"moveCost"!==r&&"constructor"!==r&&(t[r]=e[r])})),t}return e};return t({currentTurn:this.currentTurn,maxScore:this.maxScore,currentLevel:this.currentLevel,playerTeam:this.playerTeam,enemyTeam:this.enemyTeam,positionedPlayerCharacters:this.positionedPlayerCharacters,positionedEnemyCharacters:this.positionedEnemyCharacters})}}class B{constructor(t,e){this.storage=t,this.gamePlay=e}save(t){try{const e=new v(t.currentTurn,t.maxScore,t.currentLevel,t.playerTeam,t.enemyTeam,t.positionedPlayerCharacters,t.positionedEnemyCharacters).serialize();this.storage.setItem("state",JSON.stringify(e)),this.gamePlay.showMessage("Игра сохранена")}catch(t){console.error("Ошибка сохранения:",t),this.gamePlay.showError("Не удалось сохранить игру")}}load(){try{const t=JSON.parse(this.storage.getItem("state"));if(!t)throw new Error("Нет сохраненных данных");return console.log("Loaded data:",JSON.parse(JSON.stringify(t))),this.gamePlay.showMessage("Игра загружена"),v.from(t)}catch(t){throw console.error("Load error:",t),this.gamePlay.showError("Не удалось загрузить игру"),t}}}class x extends f{constructor(t){super(t),this.attack="15-25",this.defence=25,this.type="bowman",this.moveDistance=4,this.attackDistance=3,this.actions={attack:()=>{const t=Math.floor(11*Math.random())+15,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}},hardAttack:()=>{const t=Math.floor(11*Math.random())+20,e=Math.random()<.1;return{damage:e?2*t:t,cost:2,isCritical:e}},defence:()=>({defence:2*this.defence})},this.moveCost={straight:1,diagonal:2}}}class w extends f{constructor(t){super(t),this.attack="30-40",this.defence=10,this.type="swordsman",this.moveDistance=4,this.attackDistance=1,this.actions={attack:()=>{const t=Math.floor(11*Math.random())+30,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}},hardAttack:()=>{const t=Math.floor(11*Math.random())+40,e=Math.random()<.1;return{damage:e?2*t:t,cost:2,isCritical:e}},defence:()=>({defence:2*this.defence})}}}class k extends f{constructor(t){super(t),this.attack="10-20",this.defence=40,this.type="magician",this.moveDistance=2,this.attackDistance=4,this.actions={attack:()=>{const t=Math.floor(11*Math.random())+10,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}},hardAttack:()=>{const t=Math.floor(11*Math.random())+20,e=Math.random()<.1;return{damage:e?2*t:t,cost:2,isCritical:e}},defence:()=>({defence:2*this.defence})},this.actions.resurrect=()=>({healthRestored:this.maxHealth/2,cost:2}),this.moveCost={straight:2,diagonal:3}}}class P extends f{constructor(t){super(t),this.attack="10-20",this.defence=40,this.type="daemon",this.moveDistance=2,this.attackDistance=2,this.team="enemy",this.actions={attack:()=>{const t=Math.floor(11*Math.random())+20,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}}}}}class L extends f{constructor(t){super(t),this.attack="30-40",this.defence=10,this.type="undead",this.moveDistance=4,this.attackDistance=2,this.actions={attack:()=>{const t=Math.floor(11*Math.random())+30,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}}}}}class D extends f{constructor(t){super(t),this.attack="15-25",this.defence=25,this.type="vampire",this.moveDistance=2,this.attackDistance=2,this.actions={attack:()=>{const t=Math.floor(11*Math.random())+10,e=Math.random()<.15;return{damage:e?1.5*t:t,cost:1,isCritical:e}}}}}const T=new class{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div id="game-stats">\n        <div>Уровень: <span id="current-level">1</span></div>\n        <div>Макс. счет: <span id="max-score">0</span></div>\n      </div>\n      <div id="action-points"></div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n      <div class="game-info">\n        <div id="current-turn" class="turn-indicator"></div>\n        <div id="game-message" class="game-message"></div>\n        <div id="game-error" class="game-error"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(t=>this.onNewGameClick(t))),this.saveGameEl.addEventListener("click",(t=>this.onSaveGameClick(t))),this.loadGameEl.addEventListener("click",(t=>this.onLoadGameClick(t))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const e=document.createElement("div");e.classList.add("cell","map-tile",`map-tile-${C(t,this.boardSize)}`),e.addEventListener("mouseenter",(t=>this.onCellEnter(t))),e.addEventListener("mouseleave",(t=>this.onCellLeave(t))),e.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(e)}this.cells=Array.from(this.boardEl.children)}updateStats(t,e){const r=document.getElementById("current-level"),n=document.getElementById("max-score");r&&(r.textContent=t),n&&(n.textContent=e)}redrawPositions(t){this.cells.forEach((t=>t.innerHTML="")),t.forEach((t=>{const e=this.boardEl.children[t.position],r=document.createElement("div");r.classList.add("character",t.character.isDead?"dead":t.character.type);const n=document.createElement("div");n.classList.add("health-level");const a=document.createElement("div");var i;a.classList.add("health-level-indicator","health-level-indicator-"+((i=t.character.health)<15?"critical":i<50?"normal":"high")),a.style.width=`${t.character.health}%`,n.appendChild(a),r.appendChild(n),e.appendChild(r)}))}addCellClickListener(t){this.cellClickListeners.push(t)}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addNewGameListener(t){this.newGameListeners.push(t)}addSaveGameListener(t){this.saveGameListeners.push(t)}addLoadGameListener(t){this.loadGameListeners.push(t)}findCharacterByPosition(t,e){return t.find((t=>t.position===e))?.character}findPositionByCharacter(t,e){const r=t.find((t=>t.character===e));return r||(console.error("Character not found in positionedCharacters:",e),console.log("Current positionedCharacters:",t)),r?r.position:null}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,e)))}onCellLeave(t){this.setCursor("default"),t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,e)))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,e)))}onNewGameClick(t){t.preventDefault(),this.newGameListeners.forEach((t=>t.call(null)))}onSaveGameClick(t){t.preventDefault(),this.saveGameListeners.forEach((t=>t.call(null)))}onLoadGameClick(t){t.preventDefault(),this.loadGameListeners.forEach((t=>t.call(null)))}setCursor(t){this.boardEl.style.cursor=t}showError(t){const e=document.getElementById("game-error");e&&(e.textContent=t,setTimeout((()=>e.textContent=""),3e3))}showMessage(t){const e=document.getElementById("game-message");e&&(e.textContent=t,setTimeout((()=>e.textContent=""),3e3))}selectCell(t,e="yellow",r="solid"){this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${e}`),"dashed"===r&&this.cells[t].classList.add("selected-dashed")}deselectCell(t){this.cells[t].classList.remove("selected","selected-yellow","selected-green","selected-red","selected-dashed")}deselectAllCells(){this.cells.forEach(((t,e)=>this.deselectCell(e)))}hideActionMenu(){document.querySelectorAll(".action-menu").forEach((t=>{try{t.parentNode?.removeChild(t)}catch(t){console.error("Error removing action menu:",t)}}))}showActionMenu(t,e,r="attack"){this.hideActionMenu();const n=document.createElement("div");n.className=`action-menu ${r}-menu`,e.forEach((t=>{const e=document.createElement("button");e.className="action-button",e.textContent=t.text,e.addEventListener("click",(e=>{e.stopPropagation(),t.action()})),n.appendChild(e)})),this.cells[t].appendChild(n)}showAttackRange(t,e){const r=this.findPositionByCharacter(e,t);null!==r&&e.filter((e=>e.character.team!==t.team)).forEach((e=>{t.calculateDistance({x:r%this.boardSize,y:Math.floor(r/this.boardSize)},{x:e.position%this.boardSize,y:Math.floor(e.position/this.boardSize)})<=t.attackDistance&&this.selectCell(e.position,"red","dashed")}))}async showDamage(t,e,r=!1){const n=this.cells[t];if(!n)return;const a=n.querySelector(".damage");a&&n.contains(a)&&n.removeChild(a);const i=document.createElement("div");i.className="damage "+(r?"critical":""),i.textContent=`-${e}`,n.appendChild(i),await new Promise((t=>{i.addEventListener("animationend",(()=>{n.contains(i)&&n.removeChild(i),t()}),{once:!0})}))}showCellTooltip(t,e){const r=this.cells[e];if(!r)return;const n=r.querySelector(".custom-tooltip");n&&r.removeChild(n);const a=document.createElement("div");a.className="custom-tooltip",a.innerHTML=`\n      <span class="character-type">${t}</span>\n    `,r.appendChild(a),r.tooltip=a}removeCellTooltip(t){const e=this.cells[t];if(!e)return;const r=e.querySelector(".custom-tooltip");r&&e.contains(r)&&e.removeChild(r),delete e.tooltip}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}};T.bindToDOM(document.querySelector("#game-container"));const M=new B(localStorage,T),S=new class{constructor(t,e){this.gamePlay=t,this.stateService=e||new B(localStorage,this.gamePlay),this.playerTypes=[x,w,k],this.enemyTypes=[P,L,D],this.maxLevel=4,this.maxCharacters=3,this.characterCount=2,this.playerTeam=[],this.enemyTeam=[],this.positionedPlayerCharacters=[],this.positionedEnemyCharacters=[],this.gameState=new v,this.selectedCharacter=null,this.selectedCellIndex=null,this.isCharacterSelected=!1,this.movingCharacter=null,this.movingPath=[],this.currentLevel=1,this.maxLevel=4,this.themes=["prairie","desert","arctic","mountain"],this.maxScore=0}async checkWinConditions(){const t=this.positionedEnemyCharacters.every((t=>t.character.isDead||t.character.health<=0)),e=this.positionedPlayerCharacters.every((t=>t.character.isDead||t.character.health<=0));if(t){const t=this.calculateScore();return this.maxScore=Math.max(this.maxScore,t),this.currentLevel<this.maxLevel?await this.nextLevel():(this.gamePlay.showMessage(`Поздравляем! Вы прошли все уровни! Максимальный счет: ${this.maxScore}`),this.lockGame()),!0}return!!e&&(this.gamePlay.showMessage(`Игра окончена. Вы проиграли. Максимальный счет: ${this.maxScore}`),this.lockGame(),!0)}async nextLevel(){this.currentLevel++;const t=this.themes[this.currentLevel-1];this.increaseScore(100),this.playerTeam.characters.filter((t=>!t.isDead)).forEach((t=>{const e=t.level+80;t.health=Math.min(e,t.maxHealth);const r=t.health/t.maxHealth*100;r>50?t.defence=Math.round(1.1*t.defence):r>30&&(t.defence=Math.round(1.05*t.defence)),t.levelUp()})),this.gamePlay.showMessage(`Уровень ${this.currentLevel}! Тема: ${t}`),this.gamePlay.drawUi(t),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}calculateScore(){return this.playerTeam.characters.reduce(((t,e)=>t+10*e.level+e.health),0)}increaseScore(t){this.maxScore+=t,this.updateStats()}lockGame(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.isGameLocked=!0}updateStats(){this.gamePlay.updateStats(this.currentLevel,this.maxScore)}saveGame(){try{const t=new v(this.gameState.currentTurn,this.maxScore,this.currentLevel,this.playerTeam,this.enemyTeam,this.positionedPlayerCharacters,this.positionedEnemyCharacters);this.stateService.save(t)}catch(t){this.gamePlay.showError("Ошибка при сохранении игры"),console.error("Save error:",t)}}async loadGame(){this.isGameLocked=!1;try{const t=this.stateService.load(),e=(t,e)=>{if(!t||!t.characters)return t;const r=new b;return r.characters=t.characters.map((t=>{const r=e.find((e=>e.name.toLowerCase()===t.type));if(!r)return console.error("Character class not found:",t.type),t;const n=new r(t.level);return Object.keys(t).forEach((e=>{"actions"!==e&&"moveCost"!==e&&"constructor"!==e&&(n[e]=t[e])})),n})),r},r=(t,e)=>new E(t,e);this.maxScore=t.maxScore,this.currentLevel=t.currentLevel,this.gameState.currentTurn=t.currentTurn,this.playerTeam=e(t.playerTeam,this.playerTypes),this.enemyTeam=e(t.enemyTeam,this.enemyTypes),this.positionedPlayerCharacters=t.positionedPlayerCharacters.map((t=>{const e=this.playerTeam.characters.find((e=>e.type===t.character.type&&e.level===t.character.level))||t.character;return r(e,t.position)})),this.positionedEnemyCharacters=t.positionedEnemyCharacters.map((t=>{const e=this.enemyTeam.characters.find((e=>e.type===t.character.type&&e.level===t.character.level))||t.character;return r(e,t.position)}));const n=this.themes[this.currentLevel-1];this.gamePlay.drawUi(n),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.redrawTeams(),this.updateTurnIndicator(),this.updateStats(),this.resetCharactersActionPoints()}catch(t){console.error("Load error:",t),this.gamePlay.showError("Не удалось загрузить игру"),this.newGame()}}init(){try{const t=this.themes[this.currentLevel-1];this.gamePlay.drawUi(t),this.generateTeams(),this.redrawTeams(),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.gamePlay.setCursor=t=>{this.gamePlay.boardEl.style.cursor=t},this.gamePlay.setCursor("default")}catch(t){this.gamePlay.showError(t.message)}this.updateTurnIndicator(),this.resetCharactersActionPoints(),this.updateStats()}newGame(){this.currentLevel=1,this.isGameLocked=!1;const t=this.themes[this.currentLevel-1];this.gamePlay.drawUi(t),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}resetCharactersActionPoints(){this.playerTeam.characters.forEach((t=>{t.isDead||t.resetActionPoints()})),this.enemyTeam.characters.forEach((t=>{t.isDead||t.resetActionPoints()}))}generateTeams(){const t=Math.min(this.characterCount,this.maxCharacters);this.playerTeam=y(this.playerTypes,this.maxLevel,t),this.enemyTeam=y(this.enemyTypes,this.maxLevel,t),this.positionedPlayerCharacters=this.positionCharacters(this.playerTeam.characters,[0,1]),this.positionedEnemyCharacters=this.positionCharacters(this.enemyTeam.characters,[6,7])}positionCharacters(t,e){const r=this.gamePlay.boardSize,n=new Set,a=r*e.length;if(t.length>a)throw new Error(`Недостаточно места для ${t.length} персонажей`);return t.map((t=>{const a=e.flatMap((t=>Array.from({length:r},((e,n)=>n*r+t)))).filter((t=>!n.has(t))),i=a[Math.floor(Math.random()*a.length)];return n.add(i),new E(t,i)}))}redrawTeams(){const t=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.redrawPositions(t)}setupEventListeners(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this))}updateTurnIndicator(){const t=document.getElementById("current-turn");t&&("player"===this.gameState.currentTurn?(t.textContent="Ваш ход",t.className="player-turn"):(t.textContent="Ход противника",t.className="enemy-turn"))}onCellClick(t){if(this.isGameLocked)return void console.warn("Game is locked!");const e=this.getAllCharacters(),r=this.gamePlay.findCharacterByPosition(e,t);r?console.log("Clicked character:",{type:r.type,team:r.team,isDead:r.isDead,proto:Object.getPrototypeOf(r)}):console.log("No character at position",t),r?this.playerTeam.characters.includes(r)?this.selectCharacter(r,t):this.isCharacterSelected&&this.showAttackMenu(this.selectedCharacter,r,t):this.isCharacterSelected&&this.moveCharacter(this.selectedCharacter,t)}onCellEnter(t){const e=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].find((e=>e.position===t));if(e){const r=e.character.isDead?"not-allowed":"pointer";this.gamePlay.setCursor(r),e.character.isDead?this.gamePlay.removeCellTooltip(t):this.gamePlay.showCellTooltip(`${e.character.type} \n (🎖${e.character.level} ⚔${e.character.attack} 🛡${e.character.defence} ❤${e.character.health})`,t)}else this.gamePlay.setCursor("default"),this.gamePlay.removeCellTooltip(t)}onCellLeave(t){this.gamePlay.removeCellTooltip(t),this.gamePlay.setCursor("default")}getAllCharacters(){return[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].filter((t=>!t.character.isDead))}selectCharacter(t,e){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.selectedCharacter=t,this.selectedCellIndex=e,this.isCharacterSelected=!0,this.gamePlay.selectCell(e,"yellow"),this.updateAvailableActions()}updateAvailableActions(){this.selectedCharacter&&(this.showPossibleActions(),this.updateActionPointsDisplay(),this.showDefenceButton(this.selectedCellIndex))}async moveCharacter(t,e){const r=this.selectedCellIndex,n=this.calculatePath(r,e,t.moveDistance);if(!n||!n.includes(e))return this.gamePlay.showMessage("Невозможно переместиться! Персонаж блокирует путь."),!1;const a=this.calculateMoveCost(r,e,t);return a>t.currentActionPoints?(this.gamePlay.showError("Недостаточно очков действий!"),!1):(await this.animateMovement(t,n),t.currentActionPoints-=a,this.selectedCellIndex=e,this.updateCharacterPosition(t,e),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn(),!0)}calculateMoveCost(t,e,r){const n=this.indexToPosition(t),a=this.indexToPosition(e),i=Math.abs(n.x-a.x),o=Math.abs(n.y-a.y),s=i>0&&o>0,c=Math.max(i,o);return"magician"===r.type||"daemon"===r.type?c*(s?3:2):c*(s?2:1)}calculatePath(t,e,r){if(t===e)return[t];const n=this.gamePlay.boardSize,a=this.indexToPosition(t),i=this.indexToPosition(e),o=[t];let s={...a},c=0;for(;c<r&&(s.x!==i.x||s.y!==i.y);){s.x<i.x?s.x++:s.x>i.x&&s.x--,s.y<i.y?s.y++:s.y>i.y&&s.y--;const t=s.y*n+s.x;if(this.gamePlay.findCharacterByPosition([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],t))break;o.push(t),c++}return o}async animateMovement(t,e){const r=t.type;t.type="moving";for(let r=1;r<e.length;r++){const n=e[r];this.updateCharacterPosition(t,n),this.redrawTeams(),await new Promise((t=>setTimeout(t,200)))}t.type=r}updateCharacterPosition(t,e){console.log(`Updating position for ${t.type} to ${e}`),this.playerTeam.characters.includes(t)?this.positionedPlayerCharacters=this.positionedPlayerCharacters.map((r=>r.character===t?new E(t,e):r)):this.positionedEnemyCharacters=this.positionedEnemyCharacters.map((r=>r.character===t?new E(t,e):r));const r=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],t);console.assert(r===e,`Position update failed for ${t.type}! Expected ${e}, got ${r}`)}showAttackMenu(t,e,r){const n=[];t.currentActionPoints>=1&&n.push({text:"Атака (1 очко)",action:()=>this.performAttack(t,e,r,"attack")}),t.currentActionPoints>=2&&n.push({text:"Сильная атака (2 очка)",action:()=>this.performAttack(t,e,r,"hardAttack")}),this.gamePlay.showActionMenu(r,n,"attack")}showDefenceButton(t){if(!this.selectedCharacter?.currentActionPoints)return;const e=[{text:`Защита (${this.selectedCharacter.currentActionPoints} очков)`,action:()=>this.performDefence(this.selectedCharacter)}];this.gamePlay.showActionMenu(t,e,"defence")}getPossibleMoves(t,e){const r=this.gamePlay.boardSize,n=[];for(let a=0;a<r;a++)for(let i=0;i<r;i++){const o=a*r+i;if(Math.abs(Math.floor(t/r)-a)+Math.abs(t%r-i)<=e&&o!==t){const t=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.findCharacterByPosition(t,o)||n.push(o)}}return n}getPossibleAttacks(t,e){const r=this.gamePlay.boardSize,n=[],a="player"===this.gameState.currentTurn?this.positionedEnemyCharacters:this.positionedPlayerCharacters;for(let i=0;i<r;i++)for(let o=0;o<r;o++){const s=i*r+o,c=Math.abs(Math.floor(t/r)-i),l=Math.abs(t%r-o);c<=e&&l<=e&&s!==t&&this.gamePlay.findCharacterByPosition(a,s)&&n.push(s)}return n}showPossibleActions(){if(!this.selectedCharacter)return;this.gamePlay.deselectAllCells();const t=this.gamePlay.findPositionByCharacter(this.positionedPlayerCharacters,this.selectedCharacter);if(null===t)return;this.gamePlay.selectCell(t,"yellow");const e=Math.min(this.selectedCharacter.moveDistance,this.selectedCharacter.currentActionPoints);e>0&&this.getPossibleMoves(t,e).forEach((t=>this.gamePlay.selectCell(t,"green"))),this.getPossibleAttacks(t,this.selectedCharacter.attackDistance).forEach((t=>this.gamePlay.selectCell(t,"red")))}async performAttack(t,e,r,n){if(!t)return void console.error("Attacker is undefined");const a=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],t);if(null===a)return console.error("Attacker position not found:",t),void this.gamePlay.showError(`${t.type}: Не могу найти позицию атакующего!`);if(t.calculateDistance(this.indexToPosition(a),this.indexToPosition(r))>t.attackDistance)return void("player"===t.team&&this.gamePlay.showError("Враг слишком далеко!"));const i="attack"===n?1:2;if(t.currentActionPoints<i)return void this.gamePlay.showError("Недостаточно очков действий!");const o=t.actions[n](),s=Math.round(o.damage);await this.gamePlay.showDamage(r,s,o.isCritical),e.takeDamage(s),t.currentActionPoints-=o.cost,this.gamePlay.hideActionMenu(),this.redrawTeams(),e.health<=0&&this.handleCharacterDeath(e),this.checkTurnEnd()&&this.switchTurn()}handleCharacterDeath(t){t.die(),this.gamePlay.showMessage(`${t.type} погиб!`),this.redrawTeams(),this.checkWinConditions()}performDefence(t){const e=5*t.currentActionPoints;t.defence+=e,t.currentActionPoints=0,this.gamePlay.showMessage(`${t.type} усилил защиту на ${e} очков!`),this.gamePlay.hideActionMenu(),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn()}indexToPosition(t){const e=this.gamePlay.boardSize;return{x:t%e,y:Math.floor(t/e)}}updateActionPointsDisplay(){const t=document.getElementById("action-points");if(!t)return;let e="<h3>Очки действий:</h3>";this.playerTeam.characters.forEach((t=>{e+=`<p>${t.type}: ${t.currentActionPoints}/${t.actionPoints}</p>`})),t.innerHTML=e}checkTurnEnd(){return this.playerTeam.characters.filter((t=>!t.isDead)).every((t=>t.currentActionPoints<=0))}async switchTurn(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),"player"===this.gameState.currentTurn?this.enemyTeam.characters.forEach((t=>t.resetActionPoints())):this.playerTeam.characters.forEach((t=>t.resetActionPoints())),this.gameState.currentTurn="player"===this.gameState.currentTurn?"enemy":"player",this.updateTurnIndicator(),"enemy"!==this.gameState.currentTurn||this.isGameLocked||await this.makeEnemyMove()}async makeEnemyMove(){if(console.log("Starting enemy move. Current positions:",{players:this.positionedPlayerCharacters.map((t=>`${t.character.type}:${t.position}`)),enemies:this.positionedEnemyCharacters.map((t=>`${t.character.type}:${t.position}`))}),!await this.checkWinConditions())try{const t=this.positionedEnemyCharacters.filter((t=>!t.character.isDead&&t.character.currentActionPoints>0)).sort(((t,e)=>e.character.attackDistance-t.character.attackDistance));for(const e of t){const t=e.character,r=e.position,n=this.positionedPlayerCharacters.filter((t=>!t.character.isDead)).map((e=>({character:e.character,position:e.position,distance:t.calculateDistance(this.indexToPosition(r),this.indexToPosition(e.position))})));if(0===n.length)continue;const a=n.sort(((t,e)=>t.distance===e.distance?t.character.health-e.character.health:t.distance-e.distance)),i=a.filter((e=>e.distance<=t.attackDistance));if(i.length>0){if(await this.performAttack(t,i[0].character,i[0].position,"attack"),await this.checkWinConditions())return;continue}const o=a[0],s=this.calculatePath(r,o.position,t.moveDistance);if(s&&s.length>1){const e=s[Math.min(s.length-1,t.moveDistance)];if(this.calculateMoveCost(r,e,t)<=t.currentActionPoints&&(await this.moveEnemyCharacter(t,e),await this.checkWinConditions()))return}}}catch(t){console.error("AI move error:",t)}finally{this.switchTurn()}}getAttackTargets(t,e,r){return r.filter((r=>t.calculateDistance(this.indexToPosition(e),this.indexToPosition(r.position))<=t.attackDistance))}async moveTowardsNearestPlayer(t,e,r){const n=r.reduce(((r,n)=>{const a=t.calculateDistance(this.indexToPosition(e),this.indexToPosition(r.position));return t.calculateDistance(this.indexToPosition(e),this.indexToPosition(n.position))<a?n:r})),a=this.calculatePath(e,n.position,t.moveDistance);if(a&&a.length>1){const e=a[Math.min(a.length-1,t.moveDistance)];await this.moveEnemyCharacter(t,e)}}async moveEnemyCharacter(t,e){try{const r=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],t);if(null===r||"number"!=typeof r)return console.error("Cannot find character position before move:",t),!1;const n=this.calculatePath(r,e,t.moveDistance);if(!n||!n.includes(e))return!1;const a=this.calculateMoveCost(r,e,t);return!(a>t.currentActionPoints||(await this.animateMovement(t,n),t.currentActionPoints-=a,this.updateCharacterPosition(t,e),this.redrawTeams(),0))}catch(t){return console.error("Error in moveEnemyCharacter:",t),!1}}findPositionByCharacter(t,e){const r=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],n=r.find((t=>t.character===e));return n||console.error("Character not found:",{character:e,allPositionedChars:r.map((t=>({type:t.character.type,position:t.position,isDead:t.character.isDead})))}),n?n.position:null}}(T,M);S.init()}();
//# sourceMappingURL=bundle.js.map