!function(){"use strict";var e={186:function(e,t,r){e.exports=r.p+"assets/2429af6d3a5796e3c34b.png"},227:function(e,t,r){e.exports=r.p+"assets/265b078c3f89d3c80dbb.png"},540:function(e){e.exports=function insertStyleElement(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},756:function(e,t,r){e.exports=r.p+"assets/37f8b2da9e57f436ca05.png"},942:function(e,t,r){e.exports=r.p+"assets/d868a744c00bd9f13c08.png"},1016:function(e,t,r){var n=r(1354),a=r.n(n),o=r(6314),s=r.n(o),c=r(4417),l=r.n(c),h=new URL(r(7935),r.b),A=new URL(r(1409),r.b),d=new URL(r(3232),r.b),m=new URL(r(1265),r.b),p=new URL(r(6267),r.b),u=new URL(r(186),r.b),g=new URL(r(9745),r.b),C=new URL(r(8490),r.b),f=new URL(r(2573),r.b),E=new URL(r(4496),r.b),b=new URL(r(8956),r.b),y=new URL(r(9221),r.b),v=new URL(r(6092),r.b),w=new URL(r(4184),r.b),B=new URL(r(5513),r.b),x=new URL(r(3062),r.b),k=new URL(r(4875),r.b),P=new URL(r(5134),r.b),T=new URL(r(7335),r.b),L=new URL(r(6153),r.b),D=new URL(r(9e3),r.b),_=new URL(r(9593),r.b),S=new URL(r(5523),r.b),M=new URL(r(7986),r.b),U=new URL(r(4041),r.b),z=new URL(r(7538),r.b),G=new URL(r(1605),r.b),q=new URL(r(6318),r.b),R=new URL(r(3933),r.b),I=new URL(r(6291),r.b),$=new URL(r(9702),r.b),N=new URL(r(1906),r.b),j=new URL(r(4347),r.b),Y=new URL(r(1216),r.b),X=new URL(r(4437),r.b),O=new URL(r(3160),r.b),H=new URL(r(8782),r.b),W=new URL(r(2076),r.b),Z=new URL(r(3860),r.b),F=new URL(r(6943),r.b),J=new URL(r(6168),r.b),V=new URL(r(227),r.b),Q=new URL(r(756),r.b),K=new URL(r(9334),r.b),ee=new URL(r(942),r.b),te=s()(a()),re=l()(h),ne=l()(A),ae=l()(d),ie=l()(m),oe=l()(p),se=l()(u),ce=l()(g),le=l()(C),he=l()(f),Ae=l()(E),de=l()(b),me=l()(y),pe=l()(v),ue=l()(w),ge=l()(B),Ce=l()(x),fe=l()(k),Ee=l()(P),be=l()(T),ye=l()(L),ve=l()(D),we=l()(_),Be=l()(S),xe=l()(M),ke=l()(U),Pe=l()(z),Te=l()(G),Le=l()(q),De=l()(R),_e=l()(I),Se=l()($),Me=l()(N),Ue=l()(j),ze=l()(Y),Ge=l()(X),qe=l()(O),Re=l()(H),Ie=l()(W),$e=l()(Z),Ne=l()(F),je=l()(J),Ye=l()(V),Xe=l()(Q),Oe=l()(K),He=l()(ee);te.push([e.id,":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n  cursor: pointer;\r\n\r\n  &:hover {\r\n    background-color:rgb(195, 197, 199);\r\n    transition: color 0.2s;\r\n  }\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.game-info {\r\n  background-color: #000;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n.turn-indicator {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.game-message {\r\n  color: #4CAF50;\r\n  min-height: 20px;\r\n}\r\n\r\n.game-error {\r\n  color: #F44336;\r\n  min-height: 20px;\r\n}\r\n\r\n#game-board {\r\n  margin-top: 20px;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell:hover {\r\n  cursor: default;\r\n}\r\n\r\n.cell:hover .custom-tooltip {\r\n  display: block;\r\n}\r\n\r\n.custom-tooltip {\r\n  position: absolute;\r\n  z-index: 9999;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  border-radius: 4px;\r\n  min-width: 250px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n  font-size: 10px;\r\n  pointer-events: none;\r\n  display: flex; \r\n}\r\n\r\n\r\n.custom-tooltip .character-type {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url("+re+");\r\n  --map-tile-top-url: url("+ne+");\r\n  --map-tile-top-right-url: url("+ae+");\r\n  --map-tile-bottom-left-url: url("+ie+");\r\n  --map-tile-bottom-url: url("+oe+");\r\n  --map-tile-bottom-right-url: url("+se+");\r\n  --map-tile-left-url: url("+ce+");\r\n  --map-tile-right-url: url("+le+");\r\n  --map-tile-center-url: url("+he+");\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url("+Ae+");\r\n  --map-tile-top-url: url("+de+");\r\n  --map-tile-top-right-url: url("+me+");\r\n  --map-tile-bottom-left-url: url("+pe+");\r\n  --map-tile-bottom-url: url("+ue+");\r\n  --map-tile-bottom-right-url: url("+ge+");\r\n  --map-tile-left-url: url("+Ce+");\r\n  --map-tile-right-url: url("+fe+");\r\n  --map-tile-center-url: url("+Ee+");\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url("+be+");\r\n  --map-tile-top-url: url("+ye+");\r\n  --map-tile-top-right-url: url("+ve+");\r\n  --map-tile-bottom-left-url: url("+we+");\r\n  --map-tile-bottom-url: url("+Be+");\r\n  --map-tile-bottom-right-url: url("+xe+");\r\n  --map-tile-left-url: url("+ke+");\r\n  --map-tile-right-url: url("+Pe+");\r\n  --map-tile-center-url: url("+Te+");\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url("+Le+");\r\n  --map-tile-top-url: url("+De+");\r\n  --map-tile-top-right-url: url("+_e+");\r\n  --map-tile-bottom-left-url: url("+Se+");\r\n  --map-tile-bottom-url: url("+Me+");\r\n  --map-tile-bottom-right-url: url("+Ue+");\r\n  --map-tile-left-url: url("+ze+");\r\n  --map-tile-right-url: url("+Ge+");\r\n  --map-tile-center-url: url("+qe+");\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 1001;\r\n}\r\n\r\n.character.moving {\r\n  background: url("+Re+");\r\n}\r\n\r\n.character.bowman {\r\n  background: url("+Ie+");\r\n}\r\n\r\n.character.daemon {\r\n  background: url("+$e+");\r\n}\r\n\r\n.character.magician {\r\n  background: url("+Ne+");\r\n}\r\n\r\n.character.swordsman {\r\n  background: url("+je+");\r\n}\r\n\r\n.character.undead {\r\n  background: url("+Ye+");\r\n}\r\n\r\n.character.vampire {\r\n  background: url("+Xe+");\r\n}\r\n\r\n.character.zombie {\r\n  background: url("+Oe+");\r\n}\r\n\r\n.character.dead {\r\n  background: url("+He+");\r\n  opacity: 0.7;\r\n  filter: grayscale(70%);\r\n  pointer-events: none;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.character:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n.character.dead:hover {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n// Меню выбора действий\r\n\r\n.action-menu {\r\n  z-index: 1002;\r\n  position: absolute;\r\n  background: rgba(0, 0, 0, 0.9);\r\n}\r\n\r\n.attack-menu {\r\n  left: 100%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.defence-menu {\r\n  left: 50%;\r\n  bottom: -50%;\r\n  transform: translateX(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.resurrect-menu {\r\n  left: 50%;\r\n  top: -50%;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.action-button {\r\n  background: #333;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  margin: 2px;\r\n  cursor: pointer;\r\n  border-radius: 3px;\r\n  text-align: left;\r\n  white-space: nowrap;\r\n}\r\n\r\n.action-button:hover {\r\n  background: #555;\r\n}\r\n\r\n// анимация перемещения\r\n\r\n.character.moving {\r\n  transition: transform 0.2s ease-in-out;\r\n  transform: scale(1.1);\r\n  filter: brightness(1.2);\r\n}\r\n\r\n#action-points {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 5px;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n#action-points h3 {\r\n  margin: 0 0 5px 0;\r\n  font-size: 1em;\r\n}\r\n\r\n#action-points p {\r\n  margin: 2px 0;\r\n  font-size: 0.9em;\r\n}\r\n\r\n/* Анимация урона */\r\n.damage {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  color: #ff0;\r\n  font-weight: bold;\r\n  font-size: 1.2em;\r\n  z-index: 2000;\r\n  pointer-events: none;\r\n  text-shadow: 0 0 3px black;\r\n  will-change: transform, opacity;\r\n  animation: damageAnimation 1s forwards;\r\n}\r\n\r\n.damage.critical {\r\n  color: red;\r\n  animation: criticalHit 1s forwards;\r\n  z-index: 2000;\r\n}\r\n\r\n@keyframes damageAnimation {\r\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\r\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\r\n}\r\n\r\n@keyframes criticalHit {\r\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\r\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\r\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\r\n}\r\n\r\n/* Меню статиситки игры */\r\n\r\n#game-stats {\r\n  display: block;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n\r\n}\r\n\r\n","",{version:3,sources:["webpack://./src/css/style.css"],names:[],mappings:"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",sourcesContent:[":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n  cursor: pointer;\r\n\r\n  &:hover {\r\n    background-color:rgb(195, 197, 199);\r\n    transition: color 0.2s;\r\n  }\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.game-info {\r\n  background-color: #000;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n.turn-indicator {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.game-message {\r\n  color: #4CAF50;\r\n  min-height: 20px;\r\n}\r\n\r\n.game-error {\r\n  color: #F44336;\r\n  min-height: 20px;\r\n}\r\n\r\n#game-board {\r\n  margin-top: 20px;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n  display: block; \r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell:hover {\r\n  cursor: default;\r\n}\r\n\r\n.cell:hover .custom-tooltip {\r\n  display: block;\r\n}\r\n\r\n.custom-tooltip {\r\n  position: absolute;\r\n  z-index: 9999;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  border-radius: 4px;\r\n  min-width: 250px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n  font-size: 10px;\r\n  pointer-events: none;\r\n  display: flex; \r\n}\r\n\r\n\r\n.custom-tooltip .character-type {\r\n  font-size: 1.2em;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url('../img/prairie/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/prairie/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/prairie/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/prairie/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/prairie/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/prairie/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/prairie/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/prairie/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/prairie/map-tile-center.png');\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url('../img/desert/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/desert/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/desert/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/desert/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/desert/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/desert/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/desert/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/desert/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/desert/map-tile-center.png');\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url('../img/arctic/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/arctic/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/arctic/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/arctic/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/arctic/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/arctic/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/arctic/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/arctic/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/arctic/map-tile-center.png');\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url('../img/mountain/map-tile-top-left.png');\r\n  --map-tile-top-url: url('../img/mountain/map-tile-top.png');\r\n  --map-tile-top-right-url: url('../img/mountain/map-tile-top-right.png');\r\n  --map-tile-bottom-left-url: url('../img/mountain/map-tile-bottom-left.png');\r\n  --map-tile-bottom-url: url('../img/mountain/map-tile-bottom.png');\r\n  --map-tile-bottom-right-url: url('../img/mountain/map-tile-bottom-right.png');\r\n  --map-tile-left-url: url('../img/mountain/map-tile-left.png');\r\n  --map-tile-right-url: url('../img/mountain/map-tile-right.png');\r\n  --map-tile-center-url: url('../img/mountain/map-tile-center.png');\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 1001;\r\n}\r\n\r\n.character.moving {\r\n  background: url('../img/characters/moving.png');\r\n}\r\n\r\n.character.bowman {\r\n  background: url('../img/characters/bowman.png');\r\n}\r\n\r\n.character.daemon {\r\n  background: url('../img/characters/daemon.png');\r\n}\r\n\r\n.character.magician {\r\n  background: url('../img/characters/magician.png');\r\n}\r\n\r\n.character.swordsman {\r\n  background: url('../img/characters/swordsman.png');\r\n}\r\n\r\n.character.undead {\r\n  background: url('../img/characters/undead.png');\r\n}\r\n\r\n.character.vampire {\r\n  background: url('../img/characters/vampire.png');\r\n}\r\n\r\n.character.zombie {\r\n  background: url('../img/characters/zombie.png');\r\n}\r\n\r\n.character.dead {\r\n  background: url('../img/characters/dead.png');\r\n  opacity: 0.7;\r\n  filter: grayscale(70%);\r\n  pointer-events: none;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.character:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n.character.dead:hover {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n// Меню выбора действий\r\n\r\n.action-menu {\r\n  z-index: 1002;\r\n  position: absolute;\r\n  background: rgba(0, 0, 0, 0.9);\r\n}\r\n\r\n.attack-menu {\r\n  left: 100%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.defence-menu {\r\n  left: 50%;\r\n  bottom: -50%;\r\n  transform: translateX(-50%);\r\n  position: absolute;\r\n  z-index: 1999;\r\n}\r\n\r\n.resurrect-menu {\r\n  left: 50%;\r\n  top: -50%;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.action-button {\r\n  background: #333;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  margin: 2px;\r\n  cursor: pointer;\r\n  border-radius: 3px;\r\n  text-align: left;\r\n  white-space: nowrap;\r\n}\r\n\r\n.action-button:hover {\r\n  background: #555;\r\n}\r\n\r\n// анимация перемещения\r\n\r\n.character.moving {\r\n  transition: transform 0.2s ease-in-out;\r\n  transform: scale(1.1);\r\n  filter: brightness(1.2);\r\n}\r\n\r\n#action-points {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 5px;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n#action-points h3 {\r\n  margin: 0 0 5px 0;\r\n  font-size: 1em;\r\n}\r\n\r\n#action-points p {\r\n  margin: 2px 0;\r\n  font-size: 0.9em;\r\n}\r\n\r\n/* Анимация урона */\r\n.damage {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  color: #ff0;\r\n  font-weight: bold;\r\n  font-size: 1.2em;\r\n  z-index: 2000;\r\n  pointer-events: none;\r\n  text-shadow: 0 0 3px black;\r\n  will-change: transform, opacity;\r\n  animation: damageAnimation 1s forwards;\r\n}\r\n\r\n.damage.critical {\r\n  color: red;\r\n  animation: criticalHit 1s forwards;\r\n  z-index: 2000;\r\n}\r\n\r\n@keyframes damageAnimation {\r\n  0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }\r\n  100% { transform: translateX(-50%) translateY(-100px) scale(1.5); opacity: 0; }\r\n}\r\n\r\n@keyframes criticalHit {\r\n  0% { transform: translateX(-50%) scale(1); opacity: 1; }\r\n  50% { transform: translateX(-50%) scale(2); opacity: 1; }\r\n  100% { transform: translateX(-50%) scale(1.5); opacity: 0; }\r\n}\r\n\r\n/* Меню статиситки игры */\r\n\r\n#game-stats {\r\n  display: block;\r\n  color: white;\r\n  padding: 10px;\r\n  text-align: center;\r\n  font-family: 'Courier New', monospace;\r\n\r\n}\r\n\r\n"],sourceRoot:""}]),t.A=te},1113:function(e){e.exports=function styleTagTransform(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1216:function(e,t,r){e.exports=r.p+"assets/c75f062dddba6e98fdc6.png"},1265:function(e,t,r){e.exports=r.p+"assets/26b5f224d8750119922d.png"},1354:function(e){e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),o="/*# ".concat(a," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},1409:function(e,t,r){e.exports=r.p+"assets/946aeb948db6313f1d85.png"},1605:function(e,t,r){e.exports=r.p+"assets/246277b8ca590816b3e8.png"},1906:function(e,t,r){e.exports=r.p+"assets/f462d2ed6eedca1e4fd9.png"},2076:function(e,t,r){e.exports=r.p+"assets/58480938b9b9c149761d.png"},2573:function(e,t,r){e.exports=r.p+"assets/0089a610e6611f679b50.png"},3062:function(e,t,r){e.exports=r.p+"assets/eb1f6e4f87b977012684.png"},3160:function(e,t,r){e.exports=r.p+"assets/6f6f7c09bde970b2e41b.png"},3232:function(e,t,r){e.exports=r.p+"assets/0ac7f8258ec7166dc957.png"},3860:function(e,t,r){e.exports=r.p+"assets/884da1ccd25db8dd2ba4.png"},3933:function(e,t,r){e.exports=r.p+"assets/8b928c3eb136543e573a.png"},4041:function(e,t,r){e.exports=r.p+"assets/3d9503e0a850fda86f82.png"},4184:function(e,t,r){e.exports=r.p+"assets/f1703771380a9959d979.png"},4347:function(e,t,r){e.exports=r.p+"assets/6bacb8e25ed9ecf726bf.png"},4417:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4437:function(e,t,r){e.exports=r.p+"assets/26fdc25019c24e87f11a.png"},4496:function(e,t,r){e.exports=r.p+"assets/258d884122fabfc2f312.png"},4875:function(e,t,r){e.exports=r.p+"assets/2c19971f327b288278bb.png"},5056:function(e,t,r){e.exports=function setAttributesWithoutAttributes(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},5072:function(e){var t=[];function getIndexByIdentifier(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function modulesToDom(e,r){for(var n={},a=[],o=0;o<e.length;o++){var s=e[o],c=r.base?s[0]+r.base:s[0],l=n[c]||0,h="".concat(c," ").concat(l);n[c]=l+1;var A=getIndexByIdentifier(h),d={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==A)t[A].references++,t[A].updater(d);else{var m=addElementStyle(d,r);r.byIndex=o,t.splice(o,0,{identifier:h,updater:m,references:1})}a.push(h)}return a}function addElementStyle(e,t){var r=t.domAPI(t);r.update(e);return function updater(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,r){var n=modulesToDom(e=e||[],r=r||{});return function update(e){e=e||[];for(var a=0;a<n.length;a++){var o=getIndexByIdentifier(n[a]);t[o].references--}for(var s=modulesToDom(e,r),c=0;c<n.length;c++){var l=getIndexByIdentifier(n[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}n=s}}},5134:function(e,t,r){e.exports=r.p+"assets/51e2a5de56bd631452fe.png"},5513:function(e,t,r){e.exports=r.p+"assets/5cf9c17d6a1ea7106a6c.png"},5523:function(e,t,r){e.exports=r.p+"assets/63aae58e4690953a3857.png"},6092:function(e,t,r){e.exports=r.p+"assets/13edb269e39172ddd74f.png"},6153:function(e,t,r){e.exports=r.p+"assets/e0aa3daf6d08c62c96d9.png"},6168:function(e,t,r){e.exports=r.p+"assets/0d75fae43e9f1e48f836.png"},6267:function(e,t,r){e.exports=r.p+"assets/07d5e8127645225478b6.png"},6291:function(e,t,r){e.exports=r.p+"assets/a1d2321024649b9d8f5f.png"},6314:function(e){e.exports=function(e){var t=[];return t.toString=function toString(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function i(e,r,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(s[l]=!0)}for(var h=0;h<e.length;h++){var A=[].concat(e[h]);n&&s[A[0]]||(void 0!==o&&(void 0===A[5]||(A[1]="@layer".concat(A[5].length>0?" ".concat(A[5]):""," {").concat(A[1],"}")),A[5]=o),r&&(A[2]?(A[1]="@media ".concat(A[2]," {").concat(A[1],"}"),A[2]=r):A[2]=r),a&&(A[4]?(A[1]="@supports (".concat(A[4],") {").concat(A[1],"}"),A[4]=a):A[4]="".concat(a)),t.push(A))}},t}},6318:function(e,t,r){e.exports=r.p+"assets/ef1b0ea8c4e545d9aadc.png"},6943:function(e,t,r){e.exports=r.p+"assets/d005033b17a1141e4a23.png"},7335:function(e,t,r){e.exports=r.p+"assets/eab6a2cc5e89a4dd8e3f.png"},7538:function(e,t,r){e.exports=r.p+"assets/22e7c5ede3f747cbe27a.png"},7659:function(e){var t={};e.exports=function insertBySelector(e,r){var n=function getTarget(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},7825:function(e){e.exports=function domAPI(e){if("undefined"==typeof document)return{update:function update(){},remove:function remove(){}};var t=e.insertStyleElement(e);return{update:function update(r){!function apply(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,a&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function remove(){!function removeStyleElement(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7935:function(e,t,r){e.exports=r.p+"assets/46d63299c3420c030b4e.png"},7986:function(e,t,r){e.exports=r.p+"assets/ac9d74f57639792774bc.png"},8490:function(e,t,r){e.exports=r.p+"assets/6a84ae91f5d985ddc9ee.png"},8782:function(e,t,r){e.exports=r.p+"assets/0a77fc47d727eab6fd39.png"},8956:function(e,t,r){e.exports=r.p+"assets/dc3f97e7bbcd5ea1ded9.png"},9e3:function(e,t,r){e.exports=r.p+"assets/d31d84c693f649766aee.png"},9221:function(e,t,r){e.exports=r.p+"assets/2f1e1970c2c20cf3a8d5.png"},9334:function(e,t,r){e.exports=r.p+"assets/296dfeac15e2377fc1dc.png"},9593:function(e,t,r){e.exports=r.p+"assets/b27323cf850ed820855c.png"},9702:function(e,t,r){e.exports=r.p+"assets/1d70f1dab2dd418c3612.png"},9745:function(e,t,r){e.exports=r.p+"assets/546abb060a0837550fd1.png"}},t={};function __webpack_require__(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,__webpack_require__),a.exports}__webpack_require__.m=e,__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e}(),__webpack_require__.b=document.baseURI||self.location.href,__webpack_require__.nc=void 0;var r=__webpack_require__(5072),n=__webpack_require__.n(r),a=__webpack_require__(7825),o=__webpack_require__.n(a),s=__webpack_require__(7659),c=__webpack_require__.n(s),l=__webpack_require__(5056),h=__webpack_require__.n(l),A=__webpack_require__(540),d=__webpack_require__.n(A),m=__webpack_require__(1113),p=__webpack_require__.n(m),u=__webpack_require__(1016),g={};g.styleTagTransform=p(),g.setAttributes=h(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d();n()(u.A,g),u.A&&u.A.locals&&u.A.locals;function calcTileType(e,t){const r=t-1,n=t*t-1,a=n-(t-1);return 0===e?"top-left":e===r?"top-right":e===a?"bottom-left":e===n?"bottom-right":e<r?"top":e>a?"bottom":e%t===0?"left":e%t===t-1?"right":"center"}class Character{constructor(e,t="moving"){if("number"!=typeof e||e<1)throw new Error("Level must be a positive number");this.name=this.constructor.name,this.level=e,this.health=50,this.maxHealth=100,this.type=t,this.moveDistance=1,this.attackDistance=1,this.actionPoints=4,this.currentActionPoints=4,this.team="player",this.isDead=!1;for(let t=1;t<e;t++)this.levelUp();this.actions={attack:()=>({damage:10,cost:1}),hardAttack:()=>({damage:15,cost:2}),defence:()=>({defence:2*this.defence,cost:this.currentActionPoints}),resurrect:()=>({health:this.maxHealth/2,cost:2})},this.moveCost={straight:1,diagonal:1}}levelUp(){this.level++;const e=this.health+80;this.health=Math.min(e,this.maxHealth);const t=(80+this.health/this.maxHealth*100)/100;"number"==typeof this.attack&&(this.attack=Math.max(this.attack,Math.round(this.attack*t))),"number"==typeof this.defence&&(this.defence=Math.max(this.defence,Math.round(this.defence*t))),this.resetActionPoints()}calculateDistance(e,t){const r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return Math.max(r,n)}canAttack(e){return this.calculateDistance(this.position,e)<=this.attackDistance}getMoveCost(e,t,r){const n=e%r;return Math.floor(e/r)!==Math.floor(t/r)&&n!==t%r?this.moveCost.diagonal:this.moveCost.straight}resetActionPoints(){this.currentActionPoints=this.actionPoints}takeDamage(e){return this.health-=e,this.health<=0&&this.die(),this.health}die(){this.isDead=!0,this.health=0,this.currentActionPoints=0}}class PositionedCharacter{constructor(e,t){if(!(e instanceof Character))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}class Team{constructor(e=[]){this.characters=e}}function generateTeam(e,t,r){const n=function*characterGenerator(e,t){for(;;){const r=e[Math.floor(Math.random()*e.length)],n=Math.floor(Math.random()*t)+1;yield new r(n)}}(e,t),a=[];for(let e=0;e<r;e++)a.push(n.next().value);return new Team(a)}class Bowman extends Character{constructor(e){super(e),this.name="Bowman",this.attack="15-25",this.defence=25,this.type="bowman",this.moveDistance=4,this.attackDistance=3,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+15,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})},this.moveCost={straight:1,diagonal:2}}}class Swordsman extends Character{constructor(e){super(e),this.name="Swordsman",this.attack="30-40",this.defence=10,this.type="swordsman",this.moveDistance=4,this.attackDistance=1,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+30,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+40,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})}}}class Magician extends Character{constructor(e){super(e),this.name="Magician",this.attack="10-20",this.defence=40,this.type="magician",this.moveDistance=2,this.attackDistance=4,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+10,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}},hardAttack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.1;return{damage:t?2*e:e,cost:2,isCritical:t}},defence:()=>({defence:2*this.defence})},this.actions.resurrect=()=>({healthRestored:this.maxHealth/2,cost:2}),this.moveCost={straight:2,diagonal:3}}}class Daemon extends Character{constructor(e){super(e),this.name="Daemon",this.attack="10-20",this.defence=40,this.type="daemon",this.moveDistance=2,this.attackDistance=2,this.team="enemy",this.actions={attack:()=>{const e=Math.floor(11*Math.random())+20,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}class Undead extends Character{constructor(e){super(e),this.name="Undead",this.attack="30-40",this.defence=10,this.type="undead",this.moveDistance=4,this.attackDistance=2,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+30,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}class Vampire extends Character{constructor(e){super(e),this.name="Vampire",this.attack="15-25",this.defence=25,this.type="vampire",this.moveDistance=2,this.attackDistance=2,this.actions={attack:()=>{const e=Math.floor(11*Math.random())+10,t=Math.random()<.15;return{damage:t?1.5*e:e,cost:1,isCritical:t}}}}}class GameState{static from(e){const restoreTeam=(e,t)=>{if(!e)return null;const r=new Team;return r.characters=e.characters.map((e=>{const r=t.find((t=>t.prototype.constructor.name.toLowerCase()===e.type));if(!r)return console.error("Character class not found:",e.type),e;const n=new r(e.level);return Object.assign(n,e),n})),r},restorePositioned=(e,t)=>e.map((e=>{const r=t?.characters?.find((t=>t.type===e.character.type&&t.level===e.character.level))||e.character;return new PositionedCharacter(r,e.position)}));return new GameState(e.currentTurn,e.maxScore,e.currentLevel,restoreTeam(e.playerTeam,[Bowman,Swordsman,Magician]),restoreTeam(e.enemyTeam,[Daemon,Undead,Vampire]),restorePositioned(e.positionedPlayerCharacters,e.playerTeam),restorePositioned(e.positionedEnemyCharacters,e.enemyTeam))}constructor(e="player",t=0,r=1,n=null,a=null,o=[],s=[]){this.currentTurn=e,this.maxScore=t,this.currentLevel=r,this.playerTeam=n,this.enemyTeam=a,this.positionedPlayerCharacters=o,this.positionedEnemyCharacters=s}serialize(){const safeSerialize=e=>{if(Array.isArray(e))return e.map((e=>safeSerialize(e)));if(e instanceof PositionedCharacter)return{character:safeSerialize(e.character),position:e.position};if(e instanceof Character){const t={};return Object.keys(e).forEach((r=>{"function"!=typeof e[r]&&"actions"!==r&&"moveCost"!==r&&(t[r]=e[r])})),t.type=e.type,t}return e};return safeSerialize({currentTurn:this.currentTurn,maxScore:this.maxScore,currentLevel:this.currentLevel,playerTeam:this.playerTeam,enemyTeam:this.enemyTeam,positionedPlayerCharacters:this.positionedPlayerCharacters,positionedEnemyCharacters:this.positionedEnemyCharacters,isGameLocked:!1})}}class GameStateService{constructor(e,t){this.storage=e,this.gamePlay=t}save(e){try{const t=new GameState(e.currentTurn,e.maxScore,e.currentLevel,e.playerTeam,e.enemyTeam,e.positionedPlayerCharacters,e.positionedEnemyCharacters).serialize();this.storage.setItem("state",JSON.stringify(t)),this.gamePlay.showMessage("Игра сохранена")}catch(e){console.error("Ошибка сохранения:",e),this.gamePlay.showError("Не удалось сохранить игру")}}load(){try{const e=JSON.parse(this.storage.getItem("state"));if(!e)throw new Error("Нет сохраненных данных");return console.log("Loaded data:",JSON.parse(JSON.stringify(e))),this.gamePlay.showMessage("Игра загружена"),GameState.from(e)}catch(e){throw console.error("Load error:",e),this.gamePlay.showError("Не удалось загрузить игру"),e}}}const C=new class GamePlay{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div id="game-stats">\n        <div>Уровень: <span id="current-level">1</span></div>\n        <div>Макс. счет: <span id="max-score">0</span></div>\n      </div>\n      <div id="action-points"></div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n      <div class="game-info">\n        <div id="current-turn" class="turn-indicator"></div>\n        <div id="game-message" class="game-message"></div>\n        <div id="game-error" class="game-error"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.saveGameEl.addEventListener("click",(e=>this.onSaveGameClick(e))),this.loadGameEl.addEventListener("click",(e=>this.onLoadGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const t=document.createElement("div");t.classList.add("cell","map-tile",`map-tile-${calcTileType(e,this.boardSize)}`),t.addEventListener("mouseenter",(e=>this.onCellEnter(e))),t.addEventListener("mouseleave",(e=>this.onCellLeave(e))),t.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(t)}this.cells=Array.from(this.boardEl.children)}updateStats(e,t){const r=document.getElementById("current-level"),n=document.getElementById("max-score");r&&(r.textContent=e),n&&(n.textContent=t)}redrawPositions(e){this.cells.forEach((e=>e.innerHTML="")),e.forEach((e=>{const t=this.boardEl.children[e.position],r=document.createElement("div");r.classList.add("character",e.character.isDead?"dead":e.character.type);const n=document.createElement("div");n.classList.add("health-level");const a=document.createElement("div");a.classList.add("health-level-indicator",`health-level-indicator-${function calcHealthLevel(e){return e<15?"critical":e<50?"normal":"high"}(e.character.health)}`),a.style.width=`${e.character.health}%`,n.appendChild(a),r.appendChild(n),t.appendChild(r)}))}addCellClickListener(e){this.cellClickListeners.push(e)}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}findCharacterByPosition(e,t){return e.find((e=>e.position===t))?.character}findPositionByCharacter(e,t){const r=e.find((e=>e.character===t));return r||(console.error("Character not found in positionedCharacters:",t),console.log("Current positionedCharacters:",e)),r?r.position:null}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){this.setCursor("default"),e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach((e=>e.call(null)))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach((e=>e.call(null)))}setCursor(e){this.boardEl.style.cursor=e}showError(e){const t=document.getElementById("game-error");t&&(t.textContent=e,setTimeout((()=>t.textContent=""),3e3))}showMessage(e){const t=document.getElementById("game-message");t&&(t.textContent=e,setTimeout((()=>t.textContent=""),3e3))}selectCell(e,t="yellow",r="solid"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`),"dashed"===r&&this.cells[e].classList.add("selected-dashed")}deselectCell(e){this.cells[e].classList.remove("selected","selected-yellow","selected-green","selected-red","selected-dashed")}deselectAllCells(){this.cells.forEach(((e,t)=>this.deselectCell(t)))}hideActionMenu(){document.querySelectorAll(".action-menu").forEach((e=>{try{e.parentNode?.removeChild(e)}catch(e){console.error("Error removing action menu:",e)}}))}showActionMenu(e,t,r="attack"){this.hideActionMenu();const n=document.createElement("div");n.className=`action-menu ${r}-menu`,t.forEach((e=>{const t=document.createElement("button");t.className="action-button",t.textContent=e.text,t.addEventListener("click",(t=>{t.stopPropagation(),e.action()})),n.appendChild(t)}));this.cells[e].appendChild(n)}showAttackRange(e,t){const r=this.findPositionByCharacter(t,e);if(null===r)return;t.filter((t=>t.character.team!==e.team)).forEach((t=>{e.calculateDistance({x:r%this.boardSize,y:Math.floor(r/this.boardSize)},{x:t.position%this.boardSize,y:Math.floor(t.position/this.boardSize)})<=e.attackDistance&&this.selectCell(t.position,"red","dashed")}))}async showDamage(e,t,r=!1){const n=this.cells[e];if(!n)return;const a=n.querySelector(".damage");a&&n.contains(a)&&n.removeChild(a);const o=document.createElement("div");o.className="damage "+(r?"critical":""),o.textContent=`-${t}`,n.appendChild(o),await new Promise((e=>{o.addEventListener("animationend",(()=>{n.contains(o)&&n.removeChild(o),e()}),{once:!0})}))}showCellTooltip(e,t){const r=this.cells[t];if(!r)return;const n=r.querySelector(".custom-tooltip");n&&r.removeChild(n);const a=document.createElement("div");a.className="custom-tooltip",a.innerHTML=`\n      <span class="character-type">${e}</span>\n    `,r.appendChild(a),r.tooltip=a}removeCellTooltip(e){const t=this.cells[e];if(!t)return;const r=t.querySelector(".custom-tooltip");r&&t.contains(r)&&t.removeChild(r),delete t.tooltip}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}};C.bindToDOM(document.querySelector("#game-container"));const f=new GameStateService(localStorage,C),E=new class GameController{constructor(e,t){this.gamePlay=e,this.stateService=t||new GameStateService(localStorage,this.gamePlay),this.playerTypes=[Bowman,Swordsman,Magician],this.enemyTypes=[Daemon,Undead,Vampire],this.maxLevel=4,this.maxCharacters=3,this.characterCount=2,this.playerTeam=[],this.enemyTeam=[],this.positionedPlayerCharacters=[],this.positionedEnemyCharacters=[],this.gameState=new GameState,this.selectedCharacter=null,this.selectedCellIndex=null,this.isCharacterSelected=!1,this.movingCharacter=null,this.movingPath=[],this.currentLevel=1,this.maxLevel=4,this.themes=["prairie","desert","arctic","mountain"],this.maxScore=0}async checkWinConditions(){const e=this.positionedEnemyCharacters.every((e=>e.character.isDead||e.character.health<=0)),t=this.positionedPlayerCharacters.every((e=>e.character.isDead||e.character.health<=0));if(e){const e=this.calculateScore();return this.maxScore=Math.max(this.maxScore,e),this.currentLevel<this.maxLevel?await this.nextLevel():(this.gamePlay.showMessage(`Поздравляем! Вы прошли все уровни! Максимальный счет: ${this.maxScore}`),this.lockGame()),!0}return!!t&&(this.gamePlay.showMessage(`Игра окончена. Вы проиграли. Максимальный счет: ${this.maxScore}`),this.lockGame(),!0)}async nextLevel(){this.currentLevel++;const e=this.themes[this.currentLevel-1];this.increaseScore(100),this.playerTeam.characters.filter((e=>!e.isDead)).forEach((e=>{const t=e.level+80;e.health=Math.min(t,e.maxHealth);const r=e.health/e.maxHealth*100;r>50?e.defence=Math.round(1.1*e.defence):r>30&&(e.defence=Math.round(1.05*e.defence)),e.levelUp()})),this.gamePlay.showMessage(`Уровень ${this.currentLevel}! Тема: ${e}`),this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}calculateScore(){return this.playerTeam.characters.reduce(((e,t)=>e+10*t.level+t.health),0)}increaseScore(e){this.maxScore+=e,this.updateStats()}lockGame(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.isGameLocked=!0}updateStats(){this.gamePlay.updateStats(this.currentLevel,this.maxScore)}saveGame(){try{const e=new GameState(this.gameState.currentTurn,this.maxScore,this.currentLevel,this.playerTeam,this.enemyTeam,this.positionedPlayerCharacters,this.positionedEnemyCharacters);this.stateService.save(e)}catch(e){this.gamePlay.showError("Ошибка при сохранении игры"),console.error("Save error:",e)}}async loadGame(){this.isGameLocked=!1;try{const e=this.stateService.load(),restoreTeam=(e,t)=>e&&e.characters?(e.characters=e.characters.map((e=>{const r=t.find((t=>t.name.toLowerCase()===e.type));if(!r)return e;const n=new r(e.level);return Object.keys(e).forEach((t=>{"actions"!==t&&"moveCost"!==t&&(n[t]=e[t])})),n})),e):e,restoreActionsAndMoveCost=e=>{const t=[...this.playerTypes,...this.enemyTypes].find((t=>t.name.toLowerCase()===e.type));if(t){const r=new t(e.level);e.actions={...r.actions},e.moveCost={...r.moveCost}}};this.maxScore=e.maxScore,this.currentLevel=e.currentLevel,this.gameState.currentTurn=e.currentTurn,this.playerTeam=restoreTeam(e.playerTeam,this.playerTypes),this.enemyTeam=restoreTeam(e.enemyTeam,this.enemyTypes),[...this.playerTeam.characters,...this.enemyTeam.characters].forEach(restoreActionsAndMoveCost);const restorePositioned=(e,t)=>t.map((t=>{const r=e?.characters?.find((e=>e.type===t.character.type&&e.level===t.character.level))||t.character;return new PositionedCharacter(r,t.position)}));this.positionedPlayerCharacters=restorePositioned(this.playerTeam,e.positionedPlayerCharacters),this.positionedEnemyCharacters=restorePositioned(this.enemyTeam,e.positionedEnemyCharacters);const t=this.themes[this.currentLevel-1];this.gamePlay.drawUi(t),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.redrawTeams(),this.updateTurnIndicator(),this.updateStats(),this.resetCharactersActionPoints(),console.log("Game loaded successfully:",{playerTeam:this.playerTeam,enemyTeam:this.enemyTeam,positionedChars:this.positionedPlayerCharacters})}catch(e){console.error("Load error:",e),this.gamePlay.showError("Не удалось загрузить игру"),this.newGame()}}init(){try{const e=this.themes[this.currentLevel-1];this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.setupEventListeners(),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.addSaveGameListener((()=>this.saveGame())),this.gamePlay.addLoadGameListener((()=>this.loadGame())),this.gamePlay.setCursor=e=>{this.gamePlay.boardEl.style.cursor=e},this.gamePlay.setCursor("default")}catch(e){this.gamePlay.showError(e.message)}this.updateTurnIndicator(),this.resetCharactersActionPoints(),this.updateStats()}newGame(){this.currentLevel=1,this.isGameLocked=!1;const e=this.themes[this.currentLevel-1];this.gamePlay.drawUi(e),this.generateTeams(),this.redrawTeams(),this.resetCharactersActionPoints(),this.updateTurnIndicator(),this.updateStats()}resetCharactersActionPoints(){this.playerTeam.characters.forEach((e=>{e.isDead||e.resetActionPoints()})),this.enemyTeam.characters.forEach((e=>{e.isDead||e.resetActionPoints()}))}generateTeams(){const e=Math.min(this.characterCount,this.maxCharacters);this.playerTeam=generateTeam(this.playerTypes,this.maxLevel,e),this.enemyTeam=generateTeam(this.enemyTypes,this.maxLevel,e),this.positionedPlayerCharacters=this.positionCharacters(this.playerTeam.characters,[0,1]),this.positionedEnemyCharacters=this.positionCharacters(this.enemyTeam.characters,[6,7])}positionCharacters(e,t){const r=this.gamePlay.boardSize,n=new Set,a=r*t.length;if(e.length>a)throw new Error(`Недостаточно места для ${e.length} персонажей`);return e.map((e=>{const a=t.flatMap((e=>Array.from({length:r},((t,n)=>n*r+e)))).filter((e=>!n.has(e))),o=a[Math.floor(Math.random()*a.length)];return n.add(o),new PositionedCharacter(e,o)}))}redrawTeams(){const e=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.redrawPositions(e)}setupEventListeners(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this))}updateTurnIndicator(){const e=document.getElementById("current-turn");e&&("player"===this.gameState.currentTurn?(e.textContent="Ваш ход",e.className="player-turn"):(e.textContent="Ход противника",e.className="enemy-turn"))}onCellClick(e){if(this.isGameLocked)return void console.warn("Game is locked!");const t=this.getAllCharacters(),r=this.gamePlay.findCharacterByPosition(t,e);r?console.log("Clicked character:",{type:r.type,team:r.team,isDead:r.isDead,proto:Object.getPrototypeOf(r)}):console.log("No character at position",e),r?this.playerTeam.characters.includes(r)?this.selectCharacter(r,e):this.isCharacterSelected&&this.showAttackMenu(this.selectedCharacter,r,e):this.isCharacterSelected&&this.moveCharacter(this.selectedCharacter,e)}onCellEnter(e){const t=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].find((t=>t.position===e));if(t){const r=t.character.isDead?"not-allowed":"pointer";this.gamePlay.setCursor(r),t.character.isDead?this.gamePlay.removeCellTooltip(e):this.gamePlay.showCellTooltip(`${t.character.type} \n (🎖${t.character.level} ⚔${t.character.attack} 🛡${t.character.defence} ❤${t.character.health})`,e)}else this.gamePlay.setCursor("default"),this.gamePlay.removeCellTooltip(e)}onCellLeave(e){this.gamePlay.removeCellTooltip(e),this.gamePlay.setCursor("default")}getAllCharacters(){return[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters].filter((e=>!e.character.isDead))}selectCharacter(e,t){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),this.selectedCharacter=e,this.selectedCellIndex=t,this.isCharacterSelected=!0,this.gamePlay.selectCell(t,"yellow"),this.updateAvailableActions()}updateAvailableActions(){this.selectedCharacter&&(this.showPossibleActions(),this.updateActionPointsDisplay(),this.showDefenceButton(this.selectedCellIndex))}async moveCharacter(e,t){const r=this.selectedCellIndex,n=this.calculatePath(r,t,e.moveDistance);if(!n||!n.includes(t))return this.gamePlay.showMessage("Невозможно переместиться! Персонаж блокирует путь."),!1;const a=this.calculateMoveCost(r,t,e);return a>e.currentActionPoints?(this.gamePlay.showError("Недостаточно очков действий!"),!1):(await this.animateMovement(e,n),e.currentActionPoints-=a,this.selectedCellIndex=t,this.updateCharacterPosition(e,t),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn(),!0)}calculateMoveCost(e,t,r){const n=this.indexToPosition(e),a=this.indexToPosition(t),o=Math.abs(n.x-a.x),s=Math.abs(n.y-a.y),c=o>0&&s>0,l=Math.max(o,s);return"magician"===r.type||"daemon"===r.type?l*(c?3:2):l*(c?2:1)}calculatePath(e,t,r){if(e===t)return[e];const n=this.gamePlay.boardSize,a=this.indexToPosition(e),o=this.indexToPosition(t),s=[e];let c={...a},l=0;for(;l<r&&(c.x!==o.x||c.y!==o.y);){c.x<o.x?c.x++:c.x>o.x&&c.x--,c.y<o.y?c.y++:c.y>o.y&&c.y--;const e=c.y*n+c.x;if(this.gamePlay.findCharacterByPosition([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e))break;s.push(e),l++}return s}async animateMovement(e,t){const r=e.type;e.type="moving";for(let r=1;r<t.length;r++){const n=t[r];this.updateCharacterPosition(e,n),this.redrawTeams(),await new Promise((e=>setTimeout(e,200)))}e.type=r}updateCharacterPosition(e,t){console.log(`Updating position for ${e.type} to ${t}`),this.playerTeam.characters.includes(e)?this.positionedPlayerCharacters=this.positionedPlayerCharacters.map((r=>r.character===e?new PositionedCharacter(e,t):r)):this.positionedEnemyCharacters=this.positionedEnemyCharacters.map((r=>r.character===e?new PositionedCharacter(e,t):r));const r=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);console.assert(r===t,`Position update failed for ${e.type}! Expected ${t}, got ${r}`)}showAttackMenu(e,t,r){const n=[];e.currentActionPoints>=1&&n.push({text:"Атака (1 очко)",action:()=>this.performAttack(e,t,r,"attack")}),e.currentActionPoints>=2&&n.push({text:"Сильная атака (2 очка)",action:()=>this.performAttack(e,t,r,"hardAttack")}),this.gamePlay.showActionMenu(r,n,"attack")}showDefenceButton(e){if(!this.selectedCharacter?.currentActionPoints)return;const t=[{text:`Защита (${this.selectedCharacter.currentActionPoints} очков)`,action:()=>this.performDefence(this.selectedCharacter)}];this.gamePlay.showActionMenu(e,t,"defence")}getPossibleMoves(e,t){const r=this.gamePlay.boardSize,n=[];for(let a=0;a<r;a++)for(let o=0;o<r;o++){const s=a*r+o;if(Math.abs(Math.floor(e/r)-a)+Math.abs(e%r-o)<=t&&s!==e){const e=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters];this.gamePlay.findCharacterByPosition(e,s)||n.push(s)}}return n}getPossibleAttacks(e,t){const r=this.gamePlay.boardSize,n=[],a="player"===this.gameState.currentTurn?this.positionedEnemyCharacters:this.positionedPlayerCharacters;for(let o=0;o<r;o++)for(let s=0;s<r;s++){const c=o*r+s,l=Math.abs(Math.floor(e/r)-o),h=Math.abs(e%r-s);if(l<=t&&h<=t&&c!==e){this.gamePlay.findCharacterByPosition(a,c)&&n.push(c)}}return n}showPossibleActions(){if(!this.selectedCharacter)return;this.gamePlay.deselectAllCells();const e=this.gamePlay.findPositionByCharacter(this.positionedPlayerCharacters,this.selectedCharacter);if(null===e)return;this.gamePlay.selectCell(e,"yellow");const t=Math.min(this.selectedCharacter.moveDistance,this.selectedCharacter.currentActionPoints);t>0&&this.getPossibleMoves(e,t).forEach((e=>this.gamePlay.selectCell(e,"green"))),this.getPossibleAttacks(e,this.selectedCharacter.attackDistance).forEach((e=>this.gamePlay.selectCell(e,"red")))}async performAttack(e,t,r,n){if(!e)return void console.error("Attacker is undefined");const a=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);if(null===a)return console.error("Attacker position not found:",e),void this.gamePlay.showError(`${e.type}: Не могу найти позицию атакующего!`);if(e.calculateDistance(this.indexToPosition(a),this.indexToPosition(r))>e.attackDistance)return void("player"===e.team&&this.gamePlay.showError("Враг слишком далеко!"));const o="attack"===n?1:2;if(e.currentActionPoints<o)return void this.gamePlay.showError("Недостаточно очков действий!");const s=e.actions[n](),c=Math.round(s.damage);await this.gamePlay.showDamage(r,c,s.isCritical),t.takeDamage(c),e.currentActionPoints-=s.cost,this.gamePlay.hideActionMenu(),this.redrawTeams(),t.health<=0&&this.handleCharacterDeath(t),this.checkTurnEnd()&&this.switchTurn()}handleCharacterDeath(e){e.die(),this.gamePlay.showMessage(`${e.type} погиб!`),this.redrawTeams(),this.checkWinConditions()}performDefence(e){const t=5*e.currentActionPoints;e.defence+=t,e.currentActionPoints=0,this.gamePlay.showMessage(`${e.type} усилил защиту на ${t} очков!`),this.gamePlay.hideActionMenu(),this.redrawTeams(),this.updateAvailableActions(),this.checkTurnEnd()&&this.switchTurn()}indexToPosition(e){const t=this.gamePlay.boardSize;return{x:e%t,y:Math.floor(e/t)}}updateActionPointsDisplay(){const e=document.getElementById("action-points");if(!e)return;let t="<h3>Очки действий:</h3>";this.playerTeam.characters.forEach((e=>{t+=`<p>${e.type}: ${e.currentActionPoints}/${e.actionPoints}</p>`})),e.innerHTML=t}checkTurnEnd(){return this.playerTeam.characters.filter((e=>!e.isDead)).every((e=>e.currentActionPoints<=0))}async switchTurn(){this.gamePlay.deselectAllCells(),this.gamePlay.hideActionMenu(),"player"===this.gameState.currentTurn?this.enemyTeam.characters.forEach((e=>e.resetActionPoints())):this.playerTeam.characters.forEach((e=>e.resetActionPoints())),this.gameState.currentTurn="player"===this.gameState.currentTurn?"enemy":"player",this.updateTurnIndicator(),"enemy"!==this.gameState.currentTurn||this.isGameLocked||await this.makeEnemyMove()}async makeEnemyMove(){if(console.log("Starting enemy move. Current positions:",{players:this.positionedPlayerCharacters.map((e=>`${e.character.type}:${e.position}`)),enemies:this.positionedEnemyCharacters.map((e=>`${e.character.type}:${e.position}`))}),!await this.checkWinConditions())try{const e=this.positionedEnemyCharacters.filter((e=>!e.character.isDead&&e.character.currentActionPoints>0)).sort(((e,t)=>t.character.attackDistance-e.character.attackDistance));for(const t of e){const e=t.character,r=t.position,n=this.positionedPlayerCharacters.filter((e=>!e.character.isDead)).map((t=>({character:t.character,position:t.position,distance:e.calculateDistance(this.indexToPosition(r),this.indexToPosition(t.position))})));if(0===n.length)continue;const a=n.sort(((e,t)=>e.distance===t.distance?e.character.health-t.character.health:e.distance-t.distance)),o=a.filter((t=>t.distance<=e.attackDistance));if(o.length>0){if(await this.performAttack(e,o[0].character,o[0].position,"attack"),await this.checkWinConditions())return;continue}const s=a[0],c=this.calculatePath(r,s.position,e.moveDistance);if(c&&c.length>1){const t=c[Math.min(c.length-1,e.moveDistance)];if(this.calculateMoveCost(r,t,e)<=e.currentActionPoints&&(await this.moveEnemyCharacter(e,t),await this.checkWinConditions()))return}}}catch(e){console.error("AI move error:",e)}finally{this.switchTurn()}}getAttackTargets(e,t,r){return r.filter((r=>e.calculateDistance(this.indexToPosition(t),this.indexToPosition(r.position))<=e.attackDistance))}async moveTowardsNearestPlayer(e,t,r){const n=r.reduce(((r,n)=>{const a=e.calculateDistance(this.indexToPosition(t),this.indexToPosition(r.position));return e.calculateDistance(this.indexToPosition(t),this.indexToPosition(n.position))<a?n:r})),a=this.calculatePath(t,n.position,e.moveDistance);if(a&&a.length>1){const t=a[Math.min(a.length-1,e.moveDistance)];await this.moveEnemyCharacter(e,t)}}async moveEnemyCharacter(e,t){try{const r=this.findPositionByCharacter([...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],e);if(null===r||"number"!=typeof r)return console.error("Cannot find character position before move:",e),!1;const n=this.calculatePath(r,t,e.moveDistance);if(!n||!n.includes(t))return!1;const a=this.calculateMoveCost(r,t,e);return!(a>e.currentActionPoints)&&(await this.animateMovement(e,n),e.currentActionPoints-=a,this.updateCharacterPosition(e,t),this.redrawTeams(),!0)}catch(e){return console.error("Error in moveEnemyCharacter:",e),!1}}findPositionByCharacter(e,t){const r=[...this.positionedPlayerCharacters,...this.positionedEnemyCharacters],n=r.find((e=>e.character===t));return n||console.error("Character not found:",{character:t,allPositionedChars:r.map((e=>({type:e.character.type,position:e.position,isDead:e.character.isDead})))}),n?n.position:null}}(C,f);E.init()}();
//# sourceMappingURL=bundle.js.map